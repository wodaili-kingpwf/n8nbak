{
  "active": true,
  "activeVersion": {
    "updatedAt": "2025-12-04T13:41:37.814Z",
    "createdAt": "2025-12-04T13:41:37.814Z",
    "versionId": "fbc83ca0-3a98-44c0-85c0-c28d45d6335a",
    "workflowId": "8yj2VoMbWmHd6I8Y",
    "nodes": [
      {
        "parameters": {
          "promptType": "define",
          "text": "=## USER_REQUEST\n{{ $json.userMessage }}\n\n## IMAGES\n{{ $json.imageKeys }}",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## Role\nYou are a personal assistant agent. Your job is to use the tools you have access to help the user with their request. \n\n## Objective\nYour goal is to collect all the information required to prepare a series of actions. \n\n## Process\n\nBased on USER_REQUEST, define the image generate/edit prompt for tool to use. And based on IMAGES, define which tool should be called.\n\nIf IMAGES is empty, you should call generate image tool to generate a brand new image for user.\n\nIf IMAGES is not empty, you should call edit image tool.\n\nBased on the response from the tools, define the response data with response format. \n\n## Response format\n\nAttribute 1: images, required\nGenerate it based on the response from the tools\n\n\n### Example responses\n{\n\t\"images\": [{\"key\": \"img_v3_02wefwe4232ff-705b-49d9-8399-9d4c1079cf8g\"}]\n}\n\n\n## Important\n1. The image generate/edit prompt should be accurate based on USER_REQUEST, do not lost any things from it.",
            "returnIntermediateSteps": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          -5504,
          9872
        ],
        "id": "f7444db9-9f85-4617-8cbe-18f6708f39fc",
        "name": "Photoshop Agent"
      },
      {
        "parameters": {
          "content": "## Brain",
          "height": 224,
          "width": 256,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -6592,
          10464
        ],
        "id": "ba94f101-9522-422d-b03b-0975f45ab5d7",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "## Tools",
          "height": 224,
          "width": 432,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -6320,
          10464
        ],
        "id": "db278cdd-253d-4e30-a839-5191d937bdcc",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "## Text/Image Input",
          "height": 336,
          "width": 832,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -7168,
          10096
        ],
        "id": "fa8e2d71-3436-4ce3-a9ff-895d9696da4d",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "content": "## Photoshop Agent",
          "height": 336,
          "width": 688,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -6320,
          10096
        ],
        "id": "00b07a00-fba4-4621-b24c-bd5ec9f7590c",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "content": "# ðŸ› ï¸ æ­å»ºæ­¥éª¤  \n**ä½œè€…:** [éª‘æ‘©æ‰˜é©¬æ–¯](https://aiwiththomas.flowus.cn/)\n\næŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ç¡®ä¿ Photoshop Agent å¯ä»¥æ­£å¸¸è¿è¡Œ:\n\n### âœ… ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¤¾åŒºç‰ˆçš„é£žä¹¦æ’ä»¶\né£žä¹¦ç›¸å…³çš„ nodes ä¸åœ¨ n8n å®˜æ–¹åˆ—è¡¨é‡Œï¼Œå› æ­¤éœ€è¦æ·»åŠ ç¤¾åŒºå¼€å‘çš„ [n8n-nodes-feishu-lark](https://github.com/zhgqthomas/n8n-nodes-feishu-lark) æ’ä»¶ã€‚n8n å®‰è£…ç¤¾åŒºæ’ä»¶çš„æ•™ç¨‹å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://docs.n8n.io/integrations/community-nodes/installation/gui-install/)ã€‚\n\n### âœ… ç¬¬äºŒæ­¥ï¼šé…ç½®é£žä¹¦ Credentials\né£žä¹¦ç›¸å…³çš„å‡­è¯çš„èŽ·å–ï¼Œå¯ä»¥å‚è€ƒé£žä¹¦[å®˜æ–¹æ–‡æ¡£](https://open.feishu.cn/document/server-docs/api-call-guide/calling-process/get-access-token)ã€‚\n\n### âœ… ç¬¬ä¸‰æ­¥: é…ç½®å¤§æ¨¡åž‹ \nå¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½æ¥é…ç½®å¤§æ¨¡åž‹ï¼ŒOpenAI æˆ–è€… Deepseek éƒ½å¯ä»¥ã€‚æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç»Ÿä¸€å¤§æ¨¡åž‹é›†æˆæŽ¥å£ã€‚å½“å‰å·¥ä½œæµä½¿ç”¨çš„æ˜¯[äº‘é›¾API](https://yunwu.ai/register?aff=3bMG)\n\n### âœ… ç¬¬å››æ­¥: é…ç½® Gemini Nano Banana API KEY\nå½“å‰å·¥ä½œæµä½¿ç”¨çš„ä¾æ—§æ˜¯[äº‘é›¾API](https://yunwu.ai/register?aff=3bMG),æä¾›çš„ Nano Banana èƒ½åŠ›\n\n",
          "height": 880,
          "width": 704
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -7904,
          10096
        ],
        "id": "b8a0243f-65bd-4e28-bb09-c6b9b4269382",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "gpt-4o"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -6496,
          10544
        ],
        "id": "752f9b35-323d-4505-b000-51ddf0cba729",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "tSJxOS7BGnKGUrYE",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "type"
              },
              {
                "name": "prompt"
              },
              {
                "name": "imageKeys",
                "type": "array"
              },
              {
                "name": "messageId"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -7120,
          11024
        ],
        "id": "31883652-886c-45c8-97e9-e4f5da77e206",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.type }}",
                      "rightValue": "edit",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "4c70dea7-ae65-44d0-8aa9-978ee9445086"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "edit"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "a5568e44-b136-47b3-8a37-e691ff90d309",
                      "leftValue": "={{ $json.type }}",
                      "rightValue": "generate",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "generate"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -6880,
          11024
        ],
        "id": "0ff731e6-b96e-41f2-bcc4-b05dd00a77ec",
        "name": "Switch"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1d9a68ea-4828-4df9-bac9-93d4dbb1d8ee",
                "name": "userMessage",
                "value": "={{ $json.contentText || $json.message?.content.text }}",
                "type": "string"
              },
              {
                "id": "681e4b77-5f01-4f24-a42c-0603442de0a0",
                "name": "imageKeys",
                "value": "={{ $json.contentImages || [] }}",
                "type": "string"
              },
              {
                "id": "5432f8a8-6e56-480f-914c-3785d9a4fafa",
                "name": "sessionId",
                "value": "={{ $json.message.chat_id }}",
                "type": "string"
              },
              {
                "id": "e867b536-3a98-44ed-b63e-757985a8ad0a",
                "name": "chatId",
                "value": "={{ $json.message?.chat_id }}",
                "type": "string"
              },
              {
                "id": "a923d1f9-b66b-4c43-b634-d6b19b392ca3",
                "name": "messageId",
                "value": "={{ $json.message?.message_id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6192,
          10256
        ],
        "id": "257ff522-2638-41e1-afa2-2ed3bed9c5e3",
        "name": "Set AI Input"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a606c986-52b2-49bc-aaa3-f2b98227edfb",
                "name": "contentText",
                "value": "={{ ($json.message.rich_content.title + '\\n' + $json.message.rich_content.content.find(item => item.tag === 'text')?.elements.map(el => el.text).join('\\n') || '').trim() }}",
                "type": "string"
              },
              {
                "id": "706e3393-9a00-4240-8f11-6d164afbde3f",
                "name": "contentImages",
                "value": "={{ $json.message.rich_content.content.find(item => item.tag === 'img')?.elements.map(el => el.image_key) }}",
                "type": "array"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6528,
          10144
        ],
        "id": "3774dc4c-3903-464b-8676-dc691aa19a75",
        "name": "Format Post Output"
      },
      {
        "parameters": {
          "description": "Use this tool to generate a brand new image. You must pass over an image generation prompt, a type. ",
          "workflowId": {
            "__rl": true,
            "value": "UV3V9KQqk57q2SZ3",
            "mode": "list",
            "cachedResultUrl": "/workflow/UV3V9KQqk57q2SZ3",
            "cachedResultName": "Photoshop Agent"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "type": "generate",
              "prompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('prompt', `The image generation prompt. This should be optimized for AI image generation. This prompt should not contain \\\\n or \"\".`, 'string') }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "type",
                "displayName": "type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "prompt",
                "displayName": "prompt",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "imageKeys",
                "displayName": "imageKeys",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "array",
                "removed": true
              },
              {
                "id": "messageId",
                "displayName": "messageId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.2,
        "position": [
          -6240,
          10544
        ],
        "id": "1c631de4-5f59-476f-9d14-045223be9a7c",
        "name": "Generate Image"
      },
      {
        "parameters": {
          "fieldToSplitOut": "imageKeys",
          "include": "selectedOtherFields",
          "fieldsToInclude": "messageId",
          "options": {
            "destinationFieldName": "key"
          }
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -6624,
          10896
        ],
        "id": "94907e60-ea13-41a4-8bb0-718b34ab8d17",
        "name": "Split Out"
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "images",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          -5840,
          10896
        ],
        "id": "541135fb-220a-4cf2-9071-fac4cc472373",
        "name": "Aggregate"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://yunwu.ai/v1beta/models/gemini-2.5-flash-image:generateContent",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "key"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"contents\": [\n    {\n      \"role\": \"user\",\n      \"parts\": [\n        {\n          \"text\": \"{{ $json.prompt }}\"\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"responseModalities\": [\n      \"TEXT\",\n      \"IMAGE\"\n    ]\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6624,
          11216
        ],
        "id": "ff91aa3f-79c9-4317-8045-87c1379ece97",
        "name": "Generate Image Request"
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "={\n  \"inline_data\": {\n    \"mime_type\": \"{{ $json.mimeType }}\",\n    \"data\": \"{{ $json.data }}\"\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6096,
          10896
        ],
        "id": "46b798f2-25a3-4de5-ba13-c2b8fb9d6872",
        "name": "Format as API Parameters"
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "data",
          "binaryPropertyName": "=data",
          "options": {}
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          -5952,
          11216
        ],
        "id": "997674b6-c89f-421d-9478-c459944888f4",
        "name": "Convert to File"
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n\t\"images\": [{\"key\": \"img_v3_02wefwe4232ff-705b-49d9-8399-9d4c1079cf8g\"}]\n}\n"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -5792,
          10544
        ],
        "id": "fd4ac123-86c5-43a3-9544-7cf5bb2b56eb",
        "name": "Structured Output Parser"
      },
      {
        "parameters": {
          "description": "Call this tool to edit images. You must pass over an image generation prompt, the type.",
          "workflowId": {
            "__rl": true,
            "value": "UV3V9KQqk57q2SZ3",
            "mode": "list",
            "cachedResultUrl": "/workflow/UV3V9KQqk57q2SZ3",
            "cachedResultName": "Photoshop Agent"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "type": "edit",
              "prompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('prompt', `The image generation prompt. This should be optimized for AI image generation. This prompt should not contain \\\\n or \"\".`, 'string') }}",
              "imageKeys": "={{ $('Set AI Input').item.json.imageKeys }}",
              "messageId": "={{ $('Set AI Input').item.json.messageId }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "type",
                "displayName": "type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "prompt",
                "displayName": "prompt",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "imageKeys",
                "displayName": "imageKeys",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "array",
                "removed": false
              },
              {
                "id": "messageId",
                "displayName": "messageId",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2.2,
        "position": [
          -6032,
          10544
        ],
        "id": "1516b4ec-1fb3-4d2b-94ac-b4082d0b8927",
        "name": "Edit Image"
      },
      {
        "parameters": {
          "content": "## Output",
          "height": 224
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -5872,
          10464
        ],
        "typeVersion": 1,
        "id": "39772f1e-ec80-4225-895b-69d3b3b408db",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3326f7b2-9529-4fcd-99eb-68d7876475d9",
                "name": "data",
                "value": "={{ ($json.candidates[0].content.parts[1] || $json.candidates[0].content.parts[0]).inlineData.data }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6192,
          11216
        ],
        "id": "d9949f10-b8ee-41ad-96be-c62b340be207",
        "name": "New Image Data"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "7b7df5bf-b15f-42ec-ae30-801027054176",
                "name": "response",
                "value": "={\"images\": \"{{ $json.image_key }}\"}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -5488,
          11216
        ],
        "id": "03c06ed4-7507-4d4c-8b49-ead87ff0ae0f",
        "name": "Response"
      },
      {
        "parameters": {
          "content": "## Sub workflow Trigger",
          "height": 592,
          "width": 448,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -7168,
          10816
        ],
        "typeVersion": 1,
        "id": "547094bb-24d5-4946-9abf-8d3fe3e13bc3",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "content": "## Edit Image Process",
          "height": 272,
          "width": 1344
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -6704,
          10816
        ],
        "typeVersion": 1,
        "id": "7885116f-bcf7-4b92-b1ae-9fd9faa85365",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "content": "## Generate Image Process",
          "height": 304,
          "width": 448,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -6704,
          11104
        ],
        "typeVersion": 1,
        "id": "44f4b3ae-eebc-4556-a70e-232744d9269b",
        "name": "Sticky Note8"
      },
      {
        "parameters": {
          "content": "## New Image Handle Process",
          "height": 304,
          "width": 880,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -6240,
          11104
        ],
        "typeVersion": 1,
        "id": "22639bab-e65b-4f43-b74e-a5769dbe9ffe",
        "name": "Sticky Note9"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://yunwu.ai/v1beta/models/gemini-2.5-flash-image:generateContent",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "key"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ (() => {return {\n  \"contents\": [\n    {\n      \"role\": \"user\",\n      \"parts\": [{text: $('Switch').item.json.prompt}, ...$json.images]\n    }\n  ],\n  \"generationConfig\": {\n    \"responseModalities\": [\n      \"TEXT\",\n      \"IMAGE\"\n    ]\n  }\n} })() }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -5568,
          10896
        ],
        "id": "cdfc6eb0-bc5e-40b6-9807-846a4aeb9b63",
        "name": "Edit Image Request"
      },
      {
        "parameters": {
          "events": [
            "im.message.receive_v1"
          ],
          "options": {}
        },
        "type": "n8n-nodes-feishu-lark.larkTrigger",
        "typeVersion": 1,
        "position": [
          -7104,
          10240
        ],
        "id": "b39d081f-7a54-46bf-82c3-739196a7bacc",
        "name": "Lark Trigger",
        "credentials": {
          "larkApi": {
            "id": "Sy7X9vjg5USGm1WQ",
            "name": "Lark Tenant Token account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "parseContent",
          "messageTypes": [
            "post",
            "text"
          ]
        },
        "type": "n8n-nodes-feishu-lark.lark",
        "typeVersion": 1,
        "position": [
          -6816,
          10240
        ],
        "id": "ce3bca90-c3fb-48b1-96fc-93cb9f317b02",
        "name": "ParseContent message",
        "webhookId": "6913b5c9-1def-4c20-a8fd-2cefbc0335f4"
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "send",
          "receive_id_type": "chat_id",
          "receive_id": {
            "__rl": true,
            "value": "={{ $('Set AI Input').item.json.chatId }}",
            "mode": "id"
          },
          "msg_type": "post",
          "content": "={{ (() => {return {\n\t\"zh_cn\": {\n\t\t\"content\": [\n          $json.output.images.map(function(item) { return {\"tag\": \"img\" , \"image_key\": item.key} })\n\t\t]\n\t}\n} })() }}",
          "options": {}
        },
        "type": "n8n-nodes-feishu-lark.lark",
        "typeVersion": 1,
        "position": [
          -5440,
          10256
        ],
        "id": "471c834d-8057-4b22-b29f-4bfb7b5cfc82",
        "name": "Send message",
        "webhookId": "ff885871-9f7e-4b7f-8f5f-ecb8f4f37324",
        "credentials": {
          "larkApi": {
            "id": "Sy7X9vjg5USGm1WQ",
            "name": "Lark Tenant Token account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "uploadImage"
        },
        "type": "n8n-nodes-feishu-lark.lark",
        "typeVersion": 1,
        "position": [
          -5712,
          11216
        ],
        "id": "bb4bc02b-de6c-48b5-8810-bfc969f943c3",
        "name": "UploadImage message",
        "webhookId": "57597332-904d-4822-9b33-01e82b94c7ff",
        "retryOnFail": true,
        "maxTries": 2,
        "waitBetweenTries": 2000,
        "credentials": {
          "larkApi": {
            "id": "Sy7X9vjg5USGm1WQ",
            "name": "Lark Tenant Token account"
          }
        }
      },
      {
        "parameters": {
          "resource": "message",
          "operation": "getContentResource",
          "message_id": "={{ $json.messageId }}",
          "file_key": "={{ $json.key }}"
        },
        "type": "n8n-nodes-feishu-lark.lark",
        "typeVersion": 1,
        "position": [
          -6368,
          10896
        ],
        "id": "fc43cf92-42f5-4766-bf7b-47d5f5fc5cc0",
        "name": "GetContentResource message",
        "webhookId": "530b855e-210b-4df6-9268-826cbf60d3ad",
        "credentials": {
          "larkApi": {
            "id": "Sy7X9vjg5USGm1WQ",
            "name": "Lark Tenant Token account"
          }
        }
      },
      {
        "parameters": {
          "model": "=deepseek-r1:7b",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
        "typeVersion": 1,
        "position": [
          -6160,
          9936
        ],
        "id": "d12a46f3-5411-4cf0-b7d9-fbc424656742",
        "name": "Ollama Chat Model",
        "credentials": {
          "ollamaApi": {
            "id": "hj7teifKzPWfUEqd",
            "name": "Ollamab"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=## USER_REQUEST\n{{ $json.userMessage }}\n\n## MESSAGE_DATA\n{{ JSON.stringify($json.message) }}\n\n## IMAGE_KEYS\n{{ $json.imageKeys }}",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=## Role\nYou are a personal assistant agent. Your job is to use the tools you have access to help the user with their request. \n\n## Objective\nYour goal is to collect all the information required to prepare a series of actions. \n\n## Process\n\nBased on USER_REQUEST, define the image generate/edit prompt for tool to use. And based on IMAGE_KEYS, define which tool should be called.\n\nIf IMAGE_KEYS is empty, you should call generate image tool to generate a brand new image for user.\n\nIf IMAGE_KEYS is not empty, you should call edit image tool and pass IMAGE_KEYS as array format to the tool and other parameters to fulfill what the tool requires from MESSAGE_DATA.\n\nBased on the response from the tools, define the response data with response format. \n\n## Response format\n\nAttribute 1: chatId, required\nExtra the it from MESSAGE_DATA\n\nAttribute 2: imageKeies, required\nGenerate it based on the response from the tools\n\nAttribute 3: description, required\nGenerate it based on the response from the tools\n\n### Example responses\n{\n\t\"chatId\": \"oc_cwefwe2323f223440b55a8a612f76869fd\",\n\t\"imageKeies\": [{\"tag\": \"img\",\"image_key\": \"img_v3_02wefwe4232ff-705b-49d9-8399-9d4c1079cf8g\"}],\n    \"description\": \"Absolutely! Here is your cute Ghibli-style cat, filled with magical charm and detailed scenery.\"\n}\n\n\n## Important\n1. IMAGE_KEYS should always keep array format, like this [a, b, c, ...]\n2. The image generate/edit prompt should be accurate based on USER_REQUEST, do not lost any things from it.",
            "returnIntermediateSteps": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          -5952,
          10176
        ],
        "id": "b95762d3-5c1e-4755-ab12-091e2c1d42da",
        "name": "Photoshop Agent1",
        "disabled": true
      }
    ],
    "connections": {
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Photoshop Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate Image Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set AI Input": {
        "main": [
          [
            {
              "node": "Photoshop Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Post Output": {
        "main": [
          [
            {
              "node": "Set AI Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Image": {
        "ai_tool": [
          [
            {
              "node": "Photoshop Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "Edit Image Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Image Request": {
        "main": [
          [
            {
              "node": "New Image Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format as API Parameters": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Photoshop Agent1",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image": {
        "ai_tool": [
          [
            {
              "node": "Photoshop Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "New Image Data": {
        "main": [
          [
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Image Request": {
        "main": [
          [
            {
              "node": "New Image Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Lark Trigger": {
        "main": [
          [
            {
              "node": "ParseContent message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ParseContent message": {
        "main": [
          [
            {
              "node": "Format Post Output",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set AI Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "GetContentResource message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File": {
        "main": [
          [
            {
              "node": "UploadImage message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "UploadImage message": {
        "main": [
          [
            {
              "node": "Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Photoshop Agent": {
        "main": [
          []
        ]
      },
      "GetContentResource message": {
        "main": [
          [
            {
              "node": "Format as API Parameters",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ollama Chat Model": {
        "ai_languageModel": [
          []
        ]
      },
      "Photoshop Agent1": {
        "main": [
          [
            {
              "node": "Send message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null
  },
  "activeVersionId": "fbc83ca0-3a98-44c0-85c0-c28d45d6335a",
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Photoshop Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Generate Image Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set AI Input": {
      "main": [
        [
          {
            "node": "Photoshop Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Post Output": {
      "main": [
        [
          {
            "node": "Set AI Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Image": {
      "ai_tool": [
        [
          {
            "node": "Photoshop Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Edit Image Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Image Request": {
      "main": [
        [
          {
            "node": "New Image Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format as API Parameters": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Photoshop Agent1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image": {
      "ai_tool": [
        [
          {
            "node": "Photoshop Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "New Image Data": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Image Request": {
      "main": [
        [
          {
            "node": "New Image Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lark Trigger": {
      "main": [
        [
          {
            "node": "ParseContent message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseContent message": {
      "main": [
        [
          {
            "node": "Format Post Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set AI Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "GetContentResource message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "UploadImage message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UploadImage message": {
      "main": [
        [
          {
            "node": "Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Photoshop Agent": {
      "main": [
        []
      ]
    },
    "GetContentResource message": {
      "main": [
        [
          {
            "node": "Format as API Parameters",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Photoshop Agent1": {
      "main": [
        [
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-11-02T08:28:06.116Z",
  "id": "8yj2VoMbWmHd6I8Y",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Photoshop Agent V1.1",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=## USER_REQUEST\n{{ $json.userMessage }}\n\n## IMAGES\n{{ $json.imageKeys }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## Role\nYou are a personal assistant agent. Your job is to use the tools you have access to help the user with their request. \n\n## Objective\nYour goal is to collect all the information required to prepare a series of actions. \n\n## Process\n\nBased on USER_REQUEST, define the image generate/edit prompt for tool to use. And based on IMAGES, define which tool should be called.\n\nIf IMAGES is empty, you should call generate image tool to generate a brand new image for user.\n\nIf IMAGES is not empty, you should call edit image tool.\n\nBased on the response from the tools, define the response data with response format. \n\n## Response format\n\nAttribute 1: images, required\nGenerate it based on the response from the tools\n\n\n### Example responses\n{\n\t\"images\": [{\"key\": \"img_v3_02wefwe4232ff-705b-49d9-8399-9d4c1079cf8g\"}]\n}\n\n\n## Important\n1. The image generate/edit prompt should be accurate based on USER_REQUEST, do not lost any things from it.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -5504,
        9872
      ],
      "id": "f7444db9-9f85-4617-8cbe-18f6708f39fc",
      "name": "Photoshop Agent"
    },
    {
      "parameters": {
        "content": "## Brain",
        "height": 224,
        "width": 256,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6592,
        10464
      ],
      "id": "ba94f101-9522-422d-b03b-0975f45ab5d7",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Tools",
        "height": 224,
        "width": 432,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6320,
        10464
      ],
      "id": "db278cdd-253d-4e30-a839-5191d937bdcc",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Text/Image Input",
        "height": 336,
        "width": 832,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -7168,
        10096
      ],
      "id": "fa8e2d71-3436-4ce3-a9ff-895d9696da4d",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Photoshop Agent",
        "height": 336,
        "width": 688,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6320,
        10096
      ],
      "id": "00b07a00-fba4-4621-b24c-bd5ec9f7590c",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "# ðŸ› ï¸ æ­å»ºæ­¥éª¤  \n**ä½œè€…:** [éª‘æ‘©æ‰˜é©¬æ–¯](https://aiwiththomas.flowus.cn/)\n\næŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ç¡®ä¿ Photoshop Agent å¯ä»¥æ­£å¸¸è¿è¡Œ:\n\n### âœ… ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¤¾åŒºç‰ˆçš„é£žä¹¦æ’ä»¶\né£žä¹¦ç›¸å…³çš„ nodes ä¸åœ¨ n8n å®˜æ–¹åˆ—è¡¨é‡Œï¼Œå› æ­¤éœ€è¦æ·»åŠ ç¤¾åŒºå¼€å‘çš„ [n8n-nodes-feishu-lark](https://github.com/zhgqthomas/n8n-nodes-feishu-lark) æ’ä»¶ã€‚n8n å®‰è£…ç¤¾åŒºæ’ä»¶çš„æ•™ç¨‹å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://docs.n8n.io/integrations/community-nodes/installation/gui-install/)ã€‚\n\n### âœ… ç¬¬äºŒæ­¥ï¼šé…ç½®é£žä¹¦ Credentials\né£žä¹¦ç›¸å…³çš„å‡­è¯çš„èŽ·å–ï¼Œå¯ä»¥å‚è€ƒé£žä¹¦[å®˜æ–¹æ–‡æ¡£](https://open.feishu.cn/document/server-docs/api-call-guide/calling-process/get-access-token)ã€‚\n\n### âœ… ç¬¬ä¸‰æ­¥: é…ç½®å¤§æ¨¡åž‹ \nå¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½æ¥é…ç½®å¤§æ¨¡åž‹ï¼ŒOpenAI æˆ–è€… Deepseek éƒ½å¯ä»¥ã€‚æˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç»Ÿä¸€å¤§æ¨¡åž‹é›†æˆæŽ¥å£ã€‚å½“å‰å·¥ä½œæµä½¿ç”¨çš„æ˜¯[äº‘é›¾API](https://yunwu.ai/register?aff=3bMG)\n\n### âœ… ç¬¬å››æ­¥: é…ç½® Gemini Nano Banana API KEY\nå½“å‰å·¥ä½œæµä½¿ç”¨çš„ä¾æ—§æ˜¯[äº‘é›¾API](https://yunwu.ai/register?aff=3bMG),æä¾›çš„ Nano Banana èƒ½åŠ›\n\n",
        "height": 880,
        "width": 704
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -7904,
        10096
      ],
      "id": "b8a0243f-65bd-4e28-bb09-c6b9b4269382",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -6496,
        10544
      ],
      "id": "752f9b35-323d-4505-b000-51ddf0cba729",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "tSJxOS7BGnKGUrYE",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "type"
            },
            {
              "name": "prompt"
            },
            {
              "name": "imageKeys",
              "type": "array"
            },
            {
              "name": "messageId"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -7120,
        11024
      ],
      "id": "31883652-886c-45c8-97e9-e4f5da77e206",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "edit",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "4c70dea7-ae65-44d0-8aa9-978ee9445086"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "edit"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a5568e44-b136-47b3-8a37-e691ff90d309",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "generate",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "generate"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -6880,
        11024
      ],
      "id": "0ff731e6-b96e-41f2-bcc4-b05dd00a77ec",
      "name": "Switch"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1d9a68ea-4828-4df9-bac9-93d4dbb1d8ee",
              "name": "userMessage",
              "value": "={{ $json.contentText || $json.message?.content.text }}",
              "type": "string"
            },
            {
              "id": "681e4b77-5f01-4f24-a42c-0603442de0a0",
              "name": "imageKeys",
              "value": "={{ $json.contentImages || [] }}",
              "type": "string"
            },
            {
              "id": "5432f8a8-6e56-480f-914c-3785d9a4fafa",
              "name": "sessionId",
              "value": "={{ $json.message.chat_id }}",
              "type": "string"
            },
            {
              "id": "e867b536-3a98-44ed-b63e-757985a8ad0a",
              "name": "chatId",
              "value": "={{ $json.message?.chat_id }}",
              "type": "string"
            },
            {
              "id": "a923d1f9-b66b-4c43-b634-d6b19b392ca3",
              "name": "messageId",
              "value": "={{ $json.message?.message_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6192,
        10256
      ],
      "id": "257ff522-2638-41e1-afa2-2ed3bed9c5e3",
      "name": "Set AI Input"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a606c986-52b2-49bc-aaa3-f2b98227edfb",
              "name": "contentText",
              "value": "={{ ($json.message.rich_content.title + '\\n' + $json.message.rich_content.content.find(item => item.tag === 'text')?.elements.map(el => el.text).join('\\n') || '').trim() }}",
              "type": "string"
            },
            {
              "id": "706e3393-9a00-4240-8f11-6d164afbde3f",
              "name": "contentImages",
              "value": "={{ $json.message.rich_content.content.find(item => item.tag === 'img')?.elements.map(el => el.image_key) }}",
              "type": "array"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6528,
        10144
      ],
      "id": "3774dc4c-3903-464b-8676-dc691aa19a75",
      "name": "Format Post Output"
    },
    {
      "parameters": {
        "description": "Use this tool to generate a brand new image. You must pass over an image generation prompt, a type. ",
        "workflowId": {
          "__rl": true,
          "value": "UV3V9KQqk57q2SZ3",
          "mode": "list",
          "cachedResultUrl": "/workflow/UV3V9KQqk57q2SZ3",
          "cachedResultName": "Photoshop Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "type": "generate",
            "prompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('prompt', `The image generation prompt. This should be optimized for AI image generation. This prompt should not contain \\\\n or \"\".`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "prompt",
              "displayName": "prompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "imageKeys",
              "displayName": "imageKeys",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": true
            },
            {
              "id": "messageId",
              "displayName": "messageId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -6240,
        10544
      ],
      "id": "1c631de4-5f59-476f-9d14-045223be9a7c",
      "name": "Generate Image"
    },
    {
      "parameters": {
        "fieldToSplitOut": "imageKeys",
        "include": "selectedOtherFields",
        "fieldsToInclude": "messageId",
        "options": {
          "destinationFieldName": "key"
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -6624,
        10896
      ],
      "id": "94907e60-ea13-41a4-8bb0-718b34ab8d17",
      "name": "Split Out"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "images",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -5840,
        10896
      ],
      "id": "541135fb-220a-4cf2-9071-fac4cc472373",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yunwu.ai/v1beta/models/gemini-2.5-flash-image:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"contents\": [\n    {\n      \"role\": \"user\",\n      \"parts\": [\n        {\n          \"text\": \"{{ $json.prompt }}\"\n        }\n      ]\n    }\n  ],\n  \"generationConfig\": {\n    \"responseModalities\": [\n      \"TEXT\",\n      \"IMAGE\"\n    ]\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6624,
        11216
      ],
      "id": "ff91aa3f-79c9-4317-8045-87c1379ece97",
      "name": "Generate Image Request"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n  \"inline_data\": {\n    \"mime_type\": \"{{ $json.mimeType }}\",\n    \"data\": \"{{ $json.data }}\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6096,
        10896
      ],
      "id": "46b798f2-25a3-4de5-ba13-c2b8fb9d6872",
      "name": "Format as API Parameters"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "binaryPropertyName": "=data",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -5952,
        11216
      ],
      "id": "997674b6-c89f-421d-9478-c459944888f4",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"images\": [{\"key\": \"img_v3_02wefwe4232ff-705b-49d9-8399-9d4c1079cf8g\"}]\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -5792,
        10544
      ],
      "id": "fd4ac123-86c5-43a3-9544-7cf5bb2b56eb",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "description": "Call this tool to edit images. You must pass over an image generation prompt, the type.",
        "workflowId": {
          "__rl": true,
          "value": "UV3V9KQqk57q2SZ3",
          "mode": "list",
          "cachedResultUrl": "/workflow/UV3V9KQqk57q2SZ3",
          "cachedResultName": "Photoshop Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "type": "edit",
            "prompt": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('prompt', `The image generation prompt. This should be optimized for AI image generation. This prompt should not contain \\\\n or \"\".`, 'string') }}",
            "imageKeys": "={{ $('Set AI Input').item.json.imageKeys }}",
            "messageId": "={{ $('Set AI Input').item.json.messageId }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "prompt",
              "displayName": "prompt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "imageKeys",
              "displayName": "imageKeys",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array",
              "removed": false
            },
            {
              "id": "messageId",
              "displayName": "messageId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -6032,
        10544
      ],
      "id": "1516b4ec-1fb3-4d2b-94ac-b4082d0b8927",
      "name": "Edit Image"
    },
    {
      "parameters": {
        "content": "## Output",
        "height": 224
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5872,
        10464
      ],
      "typeVersion": 1,
      "id": "39772f1e-ec80-4225-895b-69d3b3b408db",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3326f7b2-9529-4fcd-99eb-68d7876475d9",
              "name": "data",
              "value": "={{ ($json.candidates[0].content.parts[1] || $json.candidates[0].content.parts[0]).inlineData.data }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6192,
        11216
      ],
      "id": "d9949f10-b8ee-41ad-96be-c62b340be207",
      "name": "New Image Data"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7b7df5bf-b15f-42ec-ae30-801027054176",
              "name": "response",
              "value": "={\"images\": \"{{ $json.image_key }}\"}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -5488,
        11216
      ],
      "id": "03c06ed4-7507-4d4c-8b49-ead87ff0ae0f",
      "name": "Response"
    },
    {
      "parameters": {
        "content": "## Sub workflow Trigger",
        "height": 592,
        "width": 448,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -7168,
        10816
      ],
      "typeVersion": 1,
      "id": "547094bb-24d5-4946-9abf-8d3fe3e13bc3",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "## Edit Image Process",
        "height": 272,
        "width": 1344
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6704,
        10816
      ],
      "typeVersion": 1,
      "id": "7885116f-bcf7-4b92-b1ae-9fd9faa85365",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "## Generate Image Process",
        "height": 304,
        "width": 448,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6704,
        11104
      ],
      "typeVersion": 1,
      "id": "44f4b3ae-eebc-4556-a70e-232744d9269b",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## New Image Handle Process",
        "height": 304,
        "width": 880,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6240,
        11104
      ],
      "typeVersion": 1,
      "id": "22639bab-e65b-4f43-b74e-a5769dbe9ffe",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yunwu.ai/v1beta/models/gemini-2.5-flash-image:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => {return {\n  \"contents\": [\n    {\n      \"role\": \"user\",\n      \"parts\": [{text: $('Switch').item.json.prompt}, ...$json.images]\n    }\n  ],\n  \"generationConfig\": {\n    \"responseModalities\": [\n      \"TEXT\",\n      \"IMAGE\"\n    ]\n  }\n} })() }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -5568,
        10896
      ],
      "id": "cdfc6eb0-bc5e-40b6-9807-846a4aeb9b63",
      "name": "Edit Image Request"
    },
    {
      "parameters": {
        "events": [
          "im.message.receive_v1"
        ],
        "options": {}
      },
      "type": "n8n-nodes-feishu-lark.larkTrigger",
      "typeVersion": 1,
      "position": [
        -7104,
        10240
      ],
      "id": "b39d081f-7a54-46bf-82c3-739196a7bacc",
      "name": "Lark Trigger",
      "credentials": {
        "larkApi": {
          "id": "Sy7X9vjg5USGm1WQ",
          "name": "Lark Tenant Token account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "parseContent",
        "messageTypes": [
          "post",
          "text"
        ]
      },
      "type": "n8n-nodes-feishu-lark.lark",
      "typeVersion": 1,
      "position": [
        -6816,
        10240
      ],
      "id": "ce3bca90-c3fb-48b1-96fc-93cb9f317b02",
      "name": "ParseContent message",
      "webhookId": "6913b5c9-1def-4c20-a8fd-2cefbc0335f4"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "receive_id_type": "chat_id",
        "receive_id": {
          "__rl": true,
          "value": "={{ $('Set AI Input').item.json.chatId }}",
          "mode": "id"
        },
        "msg_type": "post",
        "content": "={{ (() => {return {\n\t\"zh_cn\": {\n\t\t\"content\": [\n          $json.output.images.map(function(item) { return {\"tag\": \"img\" , \"image_key\": item.key} })\n\t\t]\n\t}\n} })() }}",
        "options": {}
      },
      "type": "n8n-nodes-feishu-lark.lark",
      "typeVersion": 1,
      "position": [
        -5440,
        10256
      ],
      "id": "471c834d-8057-4b22-b29f-4bfb7b5cfc82",
      "name": "Send message",
      "webhookId": "ff885871-9f7e-4b7f-8f5f-ecb8f4f37324",
      "credentials": {
        "larkApi": {
          "id": "Sy7X9vjg5USGm1WQ",
          "name": "Lark Tenant Token account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "uploadImage"
      },
      "type": "n8n-nodes-feishu-lark.lark",
      "typeVersion": 1,
      "position": [
        -5712,
        11216
      ],
      "id": "bb4bc02b-de6c-48b5-8810-bfc969f943c3",
      "name": "UploadImage message",
      "webhookId": "57597332-904d-4822-9b33-01e82b94c7ff",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 2000,
      "credentials": {
        "larkApi": {
          "id": "Sy7X9vjg5USGm1WQ",
          "name": "Lark Tenant Token account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "getContentResource",
        "message_id": "={{ $json.messageId }}",
        "file_key": "={{ $json.key }}"
      },
      "type": "n8n-nodes-feishu-lark.lark",
      "typeVersion": 1,
      "position": [
        -6368,
        10896
      ],
      "id": "fc43cf92-42f5-4766-bf7b-47d5f5fc5cc0",
      "name": "GetContentResource message",
      "webhookId": "530b855e-210b-4df6-9268-826cbf60d3ad",
      "credentials": {
        "larkApi": {
          "id": "Sy7X9vjg5USGm1WQ",
          "name": "Lark Tenant Token account"
        }
      }
    },
    {
      "parameters": {
        "model": "=deepseek-r1:7b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -6160,
        9936
      ],
      "id": "d12a46f3-5411-4cf0-b7d9-fbc424656742",
      "name": "Ollama Chat Model",
      "credentials": {
        "ollamaApi": {
          "id": "hj7teifKzPWfUEqd",
          "name": "Ollamab"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=## USER_REQUEST\n{{ $json.userMessage }}\n\n## MESSAGE_DATA\n{{ JSON.stringify($json.message) }}\n\n## IMAGE_KEYS\n{{ $json.imageKeys }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=## Role\nYou are a personal assistant agent. Your job is to use the tools you have access to help the user with their request. \n\n## Objective\nYour goal is to collect all the information required to prepare a series of actions. \n\n## Process\n\nBased on USER_REQUEST, define the image generate/edit prompt for tool to use. And based on IMAGE_KEYS, define which tool should be called.\n\nIf IMAGE_KEYS is empty, you should call generate image tool to generate a brand new image for user.\n\nIf IMAGE_KEYS is not empty, you should call edit image tool and pass IMAGE_KEYS as array format to the tool and other parameters to fulfill what the tool requires from MESSAGE_DATA.\n\nBased on the response from the tools, define the response data with response format. \n\n## Response format\n\nAttribute 1: chatId, required\nExtra the it from MESSAGE_DATA\n\nAttribute 2: imageKeies, required\nGenerate it based on the response from the tools\n\nAttribute 3: description, required\nGenerate it based on the response from the tools\n\n### Example responses\n{\n\t\"chatId\": \"oc_cwefwe2323f223440b55a8a612f76869fd\",\n\t\"imageKeies\": [{\"tag\": \"img\",\"image_key\": \"img_v3_02wefwe4232ff-705b-49d9-8399-9d4c1079cf8g\"}],\n    \"description\": \"Absolutely! Here is your cute Ghibli-style cat, filled with magical charm and detailed scenery.\"\n}\n\n\n## Important\n1. IMAGE_KEYS should always keep array format, like this [a, b, c, ...]\n2. The image generate/edit prompt should be accurate based on USER_REQUEST, do not lost any things from it.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -5952,
        10176
      ],
      "id": "b95762d3-5c1e-4755-ab12-091e2c1d42da",
      "name": "Photoshop Agent1",
      "disabled": true
    }
  ],
  "pinData": {},
  "repo_name": "n8nbak",
  "repo_owner": "wodaili-kingpwf",
  "repo_path": "",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-11-02T08:28:06.119Z",
      "createdAt": "2025-11-02T08:28:06.119Z",
      "role": "workflow:owner",
      "workflowId": "8yj2VoMbWmHd6I8Y",
      "projectId": "bhYbeEidmtHtdTx7"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-11-05T12:50:55.000Z",
  "versionId": "fbc83ca0-3a98-44c0-85c0-c28d45d6335a"
}