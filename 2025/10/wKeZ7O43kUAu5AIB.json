{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "è¯»å–è‹±æ–‡SRT": {
      "main": [
        [
          {
            "node": "è§£æè‹±æ–‡å­—å¹•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æè‹±æ–‡å­—å¹•": {
      "main": [
        [
          {
            "node": "ğŸ”€ æ˜¯å¦æ‰¹å¤„ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ æ˜¯å¦æ‰¹å¤„ç†": {
      "main": [
        [
          {
            "node": "æ‰¹é‡åˆå¹¶å­—å¹•",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å•æ¡ç¿»è¯‘API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ æ‰¹é‡ç¿»è¯‘API": {
      "main": [
        [
          {
            "node": "ğŸ” æ‹†åˆ†ç¿»è¯‘ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” æ‹†åˆ†ç¿»è¯‘ç»“æœ": {
      "main": [
        [
          {
            "node": "å‡†å¤‡TTSå‘½ä»¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å•æ¡ç¿»è¯‘API": {
      "main": [
        [
          {
            "node": "åˆå¹¶å•æ¡ç¿»è¯‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆå¹¶å•æ¡ç¿»è¯‘": {
      "main": [
        [
          {
            "node": "å‡†å¤‡TTSå‘½ä»¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡TTSå‘½ä»¤": {
      "main": [
        [
          {
            "node": "ç”Ÿæˆä¸­æ–‡é…éŸ³",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç”Ÿæˆä¸­æ–‡é…éŸ³": {
      "main": [
        [
          {
            "node": "èšåˆæ‰€æœ‰ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â­ æ˜¯å¦éœ€è¦å­—å¹•": {
      "main": [
        [
          {
            "node": "å‡†å¤‡å­—å¹•æ•°æ®",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "æ¢å¤å˜é‡2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡å­—å¹•æ•°æ®": {
      "main": [
        [
          {
            "node": "ä¿å­˜å­—å¹•æ–‡ä»¶",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¿å­˜å­—å¹•æ–‡ä»¶": {
      "main": [
        [
          {
            "node": "æ¢å¤å˜é‡2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¢å¤å˜é‡2": {
      "main": [
        [
          {
            "node": "éªŒè¯å­—å¹•æ–‡ä»¶",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å­—å¹•é…ç½®": {
      "main": [
        [
          {
            "node": "è¯»å–è‹±æ–‡è§†é¢‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è®¾ç½®å·¥ä½œå˜é‡": {
      "main": [
        [
          {
            "node": "æå–éŸ³é¢‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æå–éŸ³é¢‘": {
      "main": [
        [
          {
            "node": "Whisperè¯†åˆ«è‹±æ–‡å­—å¹•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¯»å–è‹±æ–‡è§†é¢‘": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking 'Execute workflow'": {
      "main": [
        [
          {
            "node": "å­—å¹•é…ç½®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ¢å¤å˜é‡": {
      "main": [
        [
          {
            "node": "è¯»å–è‹±æ–‡SRT",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Whisperè¯†åˆ«è‹±æ–‡å­—å¹•": {
      "main": [
        [
          {
            "node": "æ¢å¤å˜é‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‰¹é‡åˆå¹¶å­—å¹•": {
      "main": [
        [
          {
            "node": "ğŸ“„ æ‰¹é‡ç¿»è¯‘API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "èšåˆæ‰€æœ‰ç»“æœ": {
      "main": [
        [
          {
            "node": "åˆå¹¶éŸ³é¢‘ç‰‡æ®µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆå¹¶éŸ³é¢‘ç‰‡æ®µ": {
      "main": [
        [
          {
            "node": "â­ æ˜¯å¦éœ€è¦å­—å¹•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡è§†é¢‘åˆæˆå‘½ä»¤": {
      "main": [
        [
          {
            "node": "æ‰§è¡Œè§†é¢‘åˆæˆ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ‰§è¡Œè§†é¢‘åˆæˆ": {
      "main": [
        [
          {
            "node": "å®Œæˆä¿¡æ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "éªŒè¯å­—å¹•æ–‡ä»¶": {
      "main": [
        [
          {
            "node": "å‡†å¤‡è§†é¢‘åˆæˆå‘½ä»¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "è®¾ç½®å·¥ä½œå˜é‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å®Œæˆä¿¡æ¯": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-10-22T13:07:39.026Z",
  "id": "wKeZ7O43kUAu5AIB",
  "isArchived": false,
  "meta": null,
  "name": "è‹±æ–‡è§†é¢‘è½¬ä¸­æ–‡é…éŸ³ - IndexTTSä¼˜åŒ–é•¿éŸ³é¢‘ä¸­æ–­ copy",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -32,
        -16
      ],
      "typeVersion": 1,
      "id": "fe6ddd8d-c78c-4a0e-b196-3de99fc67c26",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "fileSelector": "={{ $json.srtPath }}",
        "options": {}
      },
      "id": "e9f9ee20-c74b-48e2-8a85-f23be9da8f24",
      "name": "è¯»å–è‹±æ–‡SRT",
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -2656,
        224
      ]
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first();\nconst workDir = $('æ¢å¤å˜é‡').first().json.workDir;\nconst baseName = $('æ¢å¤å˜é‡').first().json.baseName;\nconst fileName = $('æ¢å¤å˜é‡').first().json.fileName;\nconst subtitleMode = $('è®¾ç½®å·¥ä½œå˜é‡').first().json.subtitleMode;\nconst batchSize = $('è®¾ç½®å·¥ä½œå˜é‡').first().json.batchSize || 15;\nconst minBatchThreshold = $('è®¾ç½®å·¥ä½œå˜é‡').first().json.minBatchThreshold || 10;\n\ntry {\n  let srtContent = '';\n\n  if (item.binary && item.binary.data && item.binary.data.data) {\n    const base64Data = item.binary.data.data;\n    srtContent = Buffer.from(base64Data, 'base64').toString('utf-8');\n  } else if (item.json.data) {\n    if (Buffer.isBuffer(item.json.data)) {\n      srtContent = item.json.data.toString('utf-8');\n    } else {\n      srtContent = item.json.data;\n    }\n  } else {\n    throw new Error('æ— æ³•è¯»å–SRTæ–‡ä»¶å†…å®¹');\n  }\n\n  srtContent = srtContent\n    .replace(/^\\uFEFF/, '')\n    .replace(/\\r\\n/g, '\\n')\n    .replace(/\\r/g, '\\n');\n\n  // è§£ææ—¶é—´æˆ³çš„å‡½æ•°\n  function parseTimestamp(timeStr) {\n    const match = timeStr.match(/(\\d{2}):(\\d{2}):(\\d{2}),(\\d{3})/);\n    if (!match) return 0;\n    const hours = parseInt(match[1]);\n    const minutes = parseInt(match[2]);\n    const seconds = parseInt(match[3]);\n    const milliseconds = parseInt(match[4]);\n    return hours * 3600 + minutes * 60 + seconds + milliseconds / 1000;\n  }\n\n  function parseSrt(text) {\n    const subtitles = [];\n    const blocks = text.trim().split(/\\n\\n+/);\n    \n    for (const block of blocks) {\n      const lines = block.trim().split('\\n');\n      if (lines.length < 3) continue;\n      \n      const index = parseInt(lines[0].trim());\n      if (isNaN(index)) continue;\n      \n      const time = lines[1].trim();\n      if (!time.includes('-->')) continue;\n      \n      const [startTime, endTime] = time.split('-->').map(t => t.trim());\n      const startSeconds = parseTimestamp(startTime);\n      const endSeconds = parseTimestamp(endTime);\n      const duration = endSeconds - startSeconds;\n      \n      // âœ… éªŒè¯æ—¶é•¿åˆç†æ€§\n      if (duration <= 0) {\n        console.warn(`âš ï¸ å­—å¹• ${index} æ—¶é•¿å¼‚å¸¸: ${duration}s,è·³è¿‡`);\n        continue;\n      }\n      \n      if (duration > 30) {\n        console.warn(`âš ï¸ å­—å¹• ${index} æ—¶é•¿è¿‡é•¿: ${duration}s`);\n      }\n      \n      const text = lines.slice(2).join('\\n').trim().replace(/<[^>]+>/g, '');\n      if (!text) continue;\n      \n      subtitles.push({ \n        index: index, \n        time: time,\n        startTime: startTime,\n        endTime: endTime,\n        startSeconds: startSeconds,\n        endSeconds: endSeconds,\n        duration: duration,\n        text: text \n      });\n    }\n    return subtitles;\n  }\n\n  const subtitles = parseSrt(srtContent);\n\n  if (subtitles.length === 0) {\n    throw new Error('æœªèƒ½è§£æä»»ä½•å­—å¹•!');\n  }\n\n  const useBatching = subtitles.length >= minBatchThreshold;\n  const processingMode = useBatching ? 'æ‰¹é‡å¤„ç†' : 'å•æ¡å¤„ç†';\n\n  console.log('\\n' + '='.repeat(60));\n  console.log('ğŸ¬ è§†é¢‘å­—å¹•åˆ†ææŠ¥å‘Š');\n  console.log('='.repeat(60));\n  console.log(`ğŸ“Š æ€»å­—å¹•æ•°: ${subtitles.length} æ¡`);\n  console.log(`âš™ï¸ å­—å¹•æ¨¡å¼: ${subtitleMode}`);\n  console.log(`ğŸ”§ å¤„ç†æ¨¡å¼: ${processingMode}`);\n  if (useBatching) {\n    const batchCount = Math.ceil(subtitles.length / batchSize);\n    console.log(`ğŸ“¦ æ‰¹æ¬¡è®¾ç½®: ${batchSize} æ¡/æ‰¹`);\n    console.log(`ğŸ“ APIè°ƒç”¨: ${batchCount} æ¬¡ (èŠ‚çœ ${Math.round((1 - batchCount/subtitles.length) * 100)}%)`);\n  } else {\n    console.log(`ğŸ“ APIè°ƒç”¨: ${subtitles.length} æ¬¡ (çŸ­è§†é¢‘,æ— éœ€æ‰¹å¤„ç†)`);\n  }\n  console.log('='.repeat(60) + '\\n');\n\n  return subtitles.map(sub => ({\n    json: {\n      index: sub.index,\n      time: sub.time,\n      startTime: sub.startTime,\n      endTime: sub.endTime,\n      startSeconds: sub.startSeconds,\n      endSeconds: sub.endSeconds,\n      duration: sub.duration,\n      englishText: sub.text,\n      workDir: workDir,\n      baseName: baseName,\n      fileName: fileName,\n      subtitleMode: subtitleMode,\n      batchSize: batchSize,\n      minBatchThreshold: minBatchThreshold,\n      totalSubtitles: subtitles.length,\n      useBatching: useBatching\n    }\n  }));\n\n} catch (error) {\n  console.error('âŒ è§£æå­—å¹•å¤±è´¥:', error.message);\n  throw error;\n}"
      },
      "id": "8eab9039-68ba-4a6f-b2e9-f56109febd71",
      "name": "è§£æè‹±æ–‡å­—å¹•",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2480,
        208
      ],
      "notes": "âœ… å·²æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¶é•¿éªŒè¯"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "use-batching",
              "leftValue": "={{ $json.useBatching }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fa811ab6-dd86-4d5e-af93-96b126606f4b",
      "name": "ğŸ”€ æ˜¯å¦æ‰¹å¤„ç†",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -2224,
        192
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.deepseek.com/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "deepSeekApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  model: 'deepseek-chat',\n  messages: [\n    {\n      role: 'system',\n      content: 'ä½ æ˜¯ä¸“ä¸šç¿»è¯‘åŠ©æ‰‹ã€‚ç¿»è¯‘è‹±æ–‡å­—å¹•ä¸ºç®€ä½“ä¸­æ–‡,ä¿æŒåŸæ„å’Œè¯­æ°”ã€‚æ ¼å¼è§„åˆ™:1.æ¯æ¡å­—å¹•ä»¥[æ•°å­—]å¼€å¤´ 2.ä¿æŒæ ¼å¼åœ¨[æ•°å­—]åç›´æ¥å†™ä¸­æ–‡ 3.åªè¿”å›ç¿»è¯‘ä¸åŠ è§£é‡Šã€‚ç¤ºä¾‹-è¾“å…¥:[1]Hello[2]Welcome è¾“å‡º:[1]å¤§å®¶å¥½[2]æ¬¢è¿'\n    },\n    {\n      role: 'user',\n      content: $json.combinedText\n    }\n  ],\n  temperature: 0.3\n} }}",
        "options": {
          "timeout": 60000
        }
      },
      "id": "c1715e39-6571-4144-930c-d695053826f7",
      "name": "ğŸ“„ æ‰¹é‡ç¿»è¯‘API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1760,
        -16
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 2000,
      "notes": "âœ… å®Œå…¨ä¿®å¤: ç›´æ¥è¿”å›JavaScriptå¯¹è±¡,n8nè‡ªåŠ¨å¤„ç†JSONè½¬æ¢"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ”¨ æ‹†åˆ†æ‰€æœ‰æ‰¹æ¬¡çš„ç¿»è¯‘ç»“æœ\n\ntry {\n  const translationItems = $input.all();\n  const batchItems = $('æ‰¹é‡åˆå¹¶å­—å¹•').all();\n\n  console.log(`\\nğŸ“¦ å¼€å§‹å¤„ç†æ‰€æœ‰æ‰¹æ¬¡: å…± ${translationItems.length} ä¸ªæ‰¹æ¬¡\\n`);\n\n  const allResults = [];\n\n  for (let i = 0; i < translationItems.length; i++) {\n    const translationItem = translationItems[i].json;\n    const batchItem = batchItems[i].json;\n    \n    const batchId = batchItem.batchId;\n    const translatedText = translationItem.choices[0].message.content.trim();\n    const originalItems = batchItem.originalItems;\n    \n    console.log(`ğŸ” æ‰¹æ¬¡ ${batchId}: å¼€å§‹æ‹†åˆ†ç¿»è¯‘ç»“æœ`);\n    console.log(`ğŸ“Š åŸå§‹å­—å¹•æ•°: ${originalItems.length} æ¡`);\n    \n    const lines = translatedText.split('\\n').filter(line => line.trim());\n    const translations = {};\n    \n    for (const line of lines) {\n      const match = line.match(/^\\[(\\d+)\\]\\s*(.+)$/);\n      if (match) {\n        const index = parseInt(match[1]);\n        translations[index] = match[2].trim();\n      }\n    }\n    \n    console.log(`âœ… æˆåŠŸè§£æ ${Object.keys(translations).length} æ¡ç¿»è¯‘`);\n    \n    const batchResults = originalItems.map((original) => {\n      const chineseText = translations[original.index];\n      \n      if (!chineseText) {\n        console.warn(`âš ï¸ å­—å¹• ${original.index} æœªæ‰¾åˆ°ç¿»è¯‘,ä½¿ç”¨åŸæ–‡`);\n      }\n      \n      return {\n        json: {\n          index: original.index,\n          time: original.time,\n          startTime: original.startTime,\n          endTime: original.endTime,\n          startSeconds: original.startSeconds,\n          endSeconds: original.endSeconds,\n          duration: original.duration,\n          englishText: original.englishText,\n          chineseText: chineseText || original.englishText,\n          workDir: original.workDir,\n          baseName: original.baseName,\n          fileName: original.fileName,\n          subtitleMode: original.subtitleMode\n        }\n      };\n    });\n    \n    console.log(`ğŸ‰ æ‰¹æ¬¡ ${batchId}: æ‹†åˆ†å®Œæˆ,è¿”å› ${batchResults.length} æ¡ç»“æœ`);\n    allResults.push(...batchResults);\n  }\n\n  console.log(`\\nâœ¨ æ‰€æœ‰æ‰¹æ¬¡å¤„ç†å®Œæˆ: æ€»å…± ${allResults.length} æ¡å­—å¹•\\n`);\n\n  return allResults;\n\n} catch (error) {\n  console.error('âŒ æ‹†åˆ†ç¿»è¯‘ç»“æœå¤±è´¥:', error.message);\n  throw error;\n}"
      },
      "id": "0b8ab3cc-4b38-4de2-abc3-e61602c4cbd2",
      "name": "ğŸ” æ‹†åˆ†ç¿»è¯‘ç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1504,
        -32
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.deepseek.com/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "deepSeekApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  model: 'deepseek-chat',\n  messages: [\n    {\n      role: 'system',\n      content: 'ä½ æ˜¯ä¸“ä¸šç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†è‹±æ–‡ç¿»è¯‘æˆç®€ä½“ä¸­æ–‡,ä¿æŒåŸæ„å’Œè¯­æ°”ã€‚åªè¿”å›ç¿»è¯‘ç»“æœ,ä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šã€‚'\n    },\n    {\n      role: 'user',\n      content: 'è¯·ç¿»è¯‘:\\n\\n' + $json.englishText\n    }\n  ],\n  temperature: 0.3\n} }}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "2e501583-421c-4618-9caa-d0ffa06ee8fb",
      "name": "å•æ¡ç¿»è¯‘API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1904,
        256
      ],
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 1000,
      "notes": "âœ… å®Œå…¨ä¿®å¤: ç›´æ¥è¿”å›JavaScriptå¯¹è±¡,n8nè‡ªåŠ¨å¤„ç†JSONè½¬æ¢"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "index",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.index }}",
              "type": "number"
            },
            {
              "id": "2",
              "name": "time",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.time }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "startTime",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.startTime }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "endTime",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.endTime }}",
              "type": "string"
            },
            {
              "id": "5",
              "name": "startSeconds",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.startSeconds }}",
              "type": "number"
            },
            {
              "id": "6",
              "name": "endSeconds",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.endSeconds }}",
              "type": "number"
            },
            {
              "id": "7",
              "name": "duration",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.duration }}",
              "type": "number"
            },
            {
              "id": "8",
              "name": "englishText",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.englishText }}",
              "type": "string"
            },
            {
              "id": "9",
              "name": "chineseText",
              "value": "={{ $json.choices[0].message.content.trim() }}",
              "type": "string"
            },
            {
              "id": "10",
              "name": "workDir",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.workDir }}",
              "type": "string"
            },
            {
              "id": "11",
              "name": "baseName",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.baseName }}",
              "type": "string"
            },
            {
              "id": "12",
              "name": "fileName",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.fileName }}",
              "type": "string"
            },
            {
              "id": "13",
              "name": "subtitleMode",
              "value": "={{ $('è§£æè‹±æ–‡å­—å¹•').item.json.subtitleMode }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "db7bef88-28cb-405c-ba56-22cbef31fc36",
      "name": "åˆå¹¶å•æ¡ç¿»è¯‘",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1584,
        256
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// âœ… æ–­ç‚¹ç»­ä¼ ç‰ˆï¼šè‡ªåŠ¨è·³è¿‡å·²ç”Ÿæˆï¼Œåˆ é™¤æŸåæ–‡ä»¶\n// é€‚ç”¨åœºæ™¯ï¼šé•¿è§†é¢‘ä¸­æ–­åç»§ç»­ç”Ÿæˆ\n\ntry {\n  const item = $input.item.json;\n  const audioIndex = String(item.index).padStart(4, '0');\n  const outputFile = `${item.workDir}/${item.baseName}_audio_${audioIndex}.mp3`;\n  const config = $('å­—å¹•é…ç½®').first().json;\n  const indexTTSDir = config.indexTTSDir;\n  const promptAudio = config.indexTTSPromptAudio;\n  \n  // é…ç½®ï¼šæŸåæ–‡ä»¶é˜ˆå€¼ï¼ˆå­—èŠ‚ï¼‰\n  const MIN_VALID_SIZE = 1024; // 1KBï¼Œå°äºæ­¤å€¼è§†ä¸ºæŸå\n\n  // âœ… æ¸…ç†æ–‡æœ¬ï¼ˆç§»é™¤ç‰¹æ®Šå­—ç¬¦é¿å…å‘½ä»¤æ‰§è¡Œé”™è¯¯ï¼‰\n  const cleanText = item.chineseText\n    .replace(/\\\\/g, '')\n    .replace(/\"/g, '')\n    .replace(/'/g, '')\n    .replace(/`/g, '')\n    .replace(/\\$/g, '')\n    .replace(/\\n/g, ' ')\n    .replace(/\\r/g, ' ')\n    .replace(/\\t/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n\n  if (!cleanText) {\n    console.warn(`âš ï¸ å­—å¹• ${item.index} æ¸…ç†åä¸ºç©ºï¼Œå°†è·³è¿‡`);\n    return {\n      ...item,\n      audioOutputFile: outputFile,\n      ttsCommand: `echo âš ï¸ å­—å¹• ${item.index} æ–‡æœ¬ä¸ºç©ºï¼Œå·²è·³è¿‡`,\n      audioIndex: audioIndex,\n      cleanedText: cleanText,\n      skipped: true\n    };\n  }\n\n  // ğŸ”¥ æ ¸å¿ƒé€»è¾‘ï¼šæ–­ç‚¹ç»­ä¼ å‘½ä»¤\n  // 1. æ–‡ä»¶ä¸å­˜åœ¨ â†’ ç”Ÿæˆ\n  // 2. æ–‡ä»¶å­˜åœ¨ä¸” > 1KB â†’ è·³è¿‡ï¼ˆå·²æˆåŠŸï¼‰\n  // 3. æ–‡ä»¶å­˜åœ¨ä½† â‰¤ 1KB â†’ åˆ é™¤åé‡æ–°ç”Ÿæˆï¼ˆæŸåï¼‰\n  \n  const ttsCommand = `powershell -Command \"if (Test-Path '${outputFile}') { $size = (Get-Item '${outputFile}').Length; if ($size -gt ${MIN_VALID_SIZE}) { Write-Host 'âœ… å­—å¹• ${item.index}: éŸ³é¢‘å·²å­˜åœ¨ (' $size 'å­—èŠ‚)ï¼Œè·³è¿‡'; exit 0 } else { Write-Host 'ğŸ”„ å­—å¹• ${item.index}: æ£€æµ‹åˆ°æŸåæ–‡ä»¶ (' $size 'å­—èŠ‚)ï¼Œåˆ é™¤å¹¶é‡æ–°ç”Ÿæˆ'; Remove-Item '${outputFile}' -Force } }; Write-Host 'ğŸµ ç”Ÿæˆå­—å¹• ${item.index} éŸ³é¢‘...'; & '${indexTTSDir}/env/python.exe' '${indexTTSDir}/tts_cli.py' --text '${cleanText}' --output '${outputFile}' --prompt '${promptAudio}' --model_dir '${indexTTSDir}/checkpoints' --fp16; if ($LASTEXITCODE -eq 0) { Write-Host 'âœ… ç”ŸæˆæˆåŠŸ' } else { Write-Host 'âŒ ç”Ÿæˆå¤±è´¥'; exit 1 }\"`;\n\n  console.log(`âœ… å­—å¹• ${item.index}: TTSå‘½ä»¤å‡†å¤‡å®Œæˆ`);\n\n  return {\n    ...item,\n    audioOutputFile: outputFile,\n    ttsCommand: ttsCommand,\n    audioIndex: audioIndex,\n    cleanedText: cleanText,\n    minValidSize: MIN_VALID_SIZE\n  };\n\n} catch (error) {\n  console.error('âŒ å‡†å¤‡TTSå‘½ä»¤å¤±è´¥:', error.message);\n  throw error;\n}"
      },
      "id": "cce3c7e9-5eec-4d2a-b352-c906aabe4172",
      "name": "å‡†å¤‡TTSå‘½ä»¤",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1296,
        176
      ],
      "notes": "Mixed TTS Engine Support: Edge-TTS (fast) + IndexTTS (quality)"
    },
    {
      "parameters": {
        "executeOnce": false,
        "command": "={{ $json.ttsCommand }}"
      },
      "id": "fe637e7b-4992-43e0-ae4c-c0037e04b164",
      "name": "ç”Ÿæˆä¸­æ–‡é…éŸ³",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -1088,
        176
      ],
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "maxTries": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "need-subtitle",
              "leftValue": "={{ $('èšåˆæ‰€æœ‰ç»“æœ').first().json.subtitleMode }}",
              "rightValue": "none",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8c44f29c-a0d1-4eb5-88cb-de3fc01e9f00",
      "name": "â­ æ˜¯å¦éœ€è¦å­—å¹•",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -176,
        64
      ],
      "notes": "âœ… å·²ä¿®å¤: ä½¿ç”¨ .first() è€Œä¸æ˜¯ .item"
    },
    {
      "parameters": {
        "jsCode": "// âœ… ä¿®å¤ç‰ˆ:å‡†å¤‡å­—å¹•æ•°æ®\n// å…³é”®ä¿®å¤:æ˜¾å¼ä»\"èšåˆæ‰€æœ‰ç»“æœ\"èŠ‚ç‚¹è·å–æ•°æ®\n\nconst aggregatedData = $('èšåˆæ‰€æœ‰ç»“æœ').first().json;\n\nconsole.log('\\n' + '='.repeat(60));\nconsole.log('ğŸ“‹ å‡†å¤‡å­—å¹•æ•°æ®');\nconsole.log('='.repeat(60));\nconsole.log(`ğŸ“‚ å·¥ä½œç›®å½•: ${aggregatedData.workDir}`);\nconsole.log(`ğŸ¯ åŸºç¡€åç§°: ${aggregatedData.baseName}`);\nconsole.log(`ğŸ­ å­—å¹•æ¨¡å¼: ${aggregatedData.subtitleMode}`);\n\nconst srtContent = aggregatedData.bilingualSrt || '';\nconst fileName = aggregatedData.srtFileName || `${aggregatedData.baseName}_subtitle.srt`;\n\nconsole.log(`ğŸ“Š å­—å¹•å†…å®¹é•¿åº¦: ${srtContent.length} å­—ç¬¦`);\nconsole.log(`ğŸ“„ å­—å¹•è¡Œæ•°: ${srtContent.split('\\n').length} è¡Œ`);\nconsole.log(`ğŸ“ å­—å¹•æ–‡ä»¶å: ${fileName}`);\n\n// âœ… å…³é”®æ£€æŸ¥:å­—å¹•å†…å®¹ä¸èƒ½ä¸ºç©º\nif (!srtContent || srtContent.length === 0) {\n  console.error('\\nâŒ é”™è¯¯: å­—å¹•å†…å®¹ä¸ºç©º!');\n  console.error('å¯èƒ½åŸå› :');\n  console.error('1. \"èšåˆæ‰€æœ‰ç»“æœ\"èŠ‚ç‚¹æœªæ­£ç¡®ç”Ÿæˆå­—å¹•');\n  console.error('2. bilingualSrt å­—æ®µä¸ºç©º');\n  throw new Error('å­—å¹•å†…å®¹ä¸ºç©º,æ— æ³•ç”Ÿæˆå­—å¹•æ–‡ä»¶');\n}\n\n// æ˜¾ç¤ºå­—å¹•å†…å®¹å‰å‡ è¡Œé¢„è§ˆ(å¸®åŠ©è°ƒè¯•)\nconst preview = srtContent.split('\\n').slice(0, 8).join('\\n');\nconsole.log('\\nğŸ“„ å­—å¹•å†…å®¹é¢„è§ˆ:');\nconsole.log(preview);\nconsole.log('...\\n');\n\n// è½¬æ¢ä¸ºbinaryæ ¼å¼\nconst srtBuffer = Buffer.from(srtContent, 'utf-8');\n\nconsole.log(`âœ… å­—å¹•æ•°æ®å‡†å¤‡å®Œæˆ`);\nconsole.log(`ğŸ’¾ Base64ç¼–ç åå¤§å°: ${srtBuffer.toString('base64').length} å­—ç¬¦`);\nconsole.log('='.repeat(60) + '\\n');\n\nreturn [{\n  json: aggregatedData,\n  binary: {\n    data: {\n      data: srtBuffer.toString('base64'),\n      mimeType: 'text/plain',\n      fileName: fileName\n    }\n  }\n}];"
      },
      "id": "24b2e11d-3932-40a6-8d81-f1a500bc9c07",
      "name": "å‡†å¤‡å­—å¹•æ•°æ®",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        144,
        -96
      ],
      "notes": "âœ… å·²ä¿®å¤: æ˜¾å¼ä»\"èšåˆæ‰€æœ‰ç»“æœ\"è·å–æ•°æ®"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "={{ $('èšåˆæ‰€æœ‰ç»“æœ').first().json.srtFilePath }}",
        "options": {}
      },
      "id": "6b97ce7d-b51f-43bb-bdd7-e8a9cd34d2ee",
      "name": "ä¿å­˜å­—å¹•æ–‡ä»¶",
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        448,
        -96
      ],
      "notes": "âœ… å·²ä¿®å¤: ä½¿ç”¨ .first() è€Œä¸æ˜¯ .item"
    },
    {
      "parameters": {
        "jsCode": "const aggregatedData = $('èšåˆæ‰€æœ‰ç»“æœ').first().json;\n\nreturn [{\n  json: {\n    workDir: aggregatedData.workDir,\n    baseName: aggregatedData.baseName,\n    fileName: aggregatedData.fileName,\n    outputAudio: aggregatedData.outputAudio,\n    srtFilePath: aggregatedData.srtFilePath,\n    srtFileName: aggregatedData.srtFileName,\n    subtitleMode: aggregatedData.subtitleMode,\n    totalItems: aggregatedData.totalItems,\n    ffmpegComplexFilter: aggregatedData.ffmpegComplexFilter\n  }\n}];"
      },
      "id": "1590d59e-b2a6-46e7-8179-5113fcb33376",
      "name": "æ¢å¤å˜é‡2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        704,
        32
      ],
      "notes": "âœ… å·²ä¿®å¤: æ˜¾å¼ä»\"èšåˆæ‰€æœ‰ç»“æœ\"è·å–æ•°æ®"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "çŠ¶æ€",
              "value": "âœ… è§†é¢‘å¤„ç†å®Œæˆ!",
              "type": "string"
            },
            {
              "id": "2",
              "name": "è¾“å‡ºè§†é¢‘",
              "value": "={{ $('å­—å¹•é…ç½®').first().json.outputDir }}/{{ $('æ¢å¤å˜é‡2').first().json.baseName }}_chinese.mp4",
              "type": "string"
            },
            {
              "id": "3",
              "name": "å­—å¹•æ¨¡å¼",
              "value": "={{ $('æ¢å¤å˜é‡2').first().json.subtitleMode }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "å­—å¹•æ–‡ä»¶",
              "value": "={{ $('æ¢å¤å˜é‡2').first().json.subtitleMode === 'none' ? 'æ— å­—å¹•' : $('æ¢å¤å˜é‡2').first().json.srtFilePath }}",
              "type": "string"
            },
            {
              "id": "5",
              "name": "ä¸­æ–‡éŸ³é¢‘",
              "value": "={{ $('æ¢å¤å˜é‡2').first().json.outputAudio }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a4b8d2d7-f06a-4da6-b06a-e23739cda87f",
      "name": "å®Œæˆä¿¡æ¯",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1664,
        400
      ],
      "notes": "âœ… å·²ä¿®å¤: æ‰€æœ‰ .item æ”¹ä¸º .first()"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "subtitleMode",
              "value": "chinese",
              "type": "string"
            },
            {
              "id": "2",
              "name": "workDir",
              "value": "I:/youtube",
              "type": "string"
            },
            {
              "id": "3",
              "name": "outputDir",
              "value": "I:/output",
              "type": "string"
            },
            {
              "id": "4",
              "name": "batchSize",
              "value": 15,
              "type": "number"
            },
            {
              "id": "5",
              "name": "minBatchThreshold",
              "value": 10,
              "type": "number"
            },
            {
              "id": "6",
              "name": "volumeLevel",
              "value": 1.8,
              "type": "number"
            },
            {
              "id": "11",
              "name": "indexTTSDir",
              "value": "H:/AI/IndexTTS_AIBL_VIP_3.0",
              "type": "string"
            },
            {
              "id": "12",
              "name": "indexTTSPromptAudio",
              "value": "H:/AI/IndexTTS_AIBL_VIP_3.0/examples/11.wav",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3bd48d62-cc63-42aa-86d5-1685e245209c",
      "name": "å­—å¹•é…ç½®",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4240,
        240
      ],
      "notes": "// - subtitleMode: å­—å¹•æ¨¡å¼\n//   * none: æ— å­—å¹•\n//   * english: ä»…è‹±æ–‡å­—å¹•\n//   * chinese: ä»…ä¸­æ–‡å­—å¹•\n//   * both: åŒè¯­å­—å¹•\n//\n// - indexTTSDir: IndexTTS çš„å®‰è£…è·¯å¾„\n// - indexTTSPromptAudio: å‚è€ƒéŸ³è‰²çš„wavæ–‡ä»¶è·¯å¾„\n//   å¯ä»¥ä½¿ç”¨ IndexTTS/examples ç›®å½•ä¸‹çš„ç¤ºä¾‹éŸ³é¢‘\n//   æˆ–è€…è‡ªå·±å‡†å¤‡3-10ç§’çš„æ¸…æ™°äººå£°wavæ–‡ä»¶"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "fileName",
              "value": "={{ $json.fileName }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "baseName",
              "value": "={{ $json.fileName.replace(/\\.[^/.]+$/, '') }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "audioFile",
              "value": "={{ $json.fileName.replace(/\\.[^/.]+$/, '') }}_audio.wav",
              "type": "string"
            },
            {
              "id": "4",
              "name": "workDir",
              "value": "={{ $('å­—å¹•é…ç½®').first().json.workDir }}",
              "type": "string"
            },
            {
              "id": "5",
              "name": "subtitleMode",
              "value": "={{ $('å­—å¹•é…ç½®').first().json.subtitleMode }}",
              "type": "string"
            },
            {
              "id": "6",
              "name": "batchSize",
              "value": "={{ $('å­—å¹•é…ç½®').first().json.batchSize }}",
              "type": "number"
            },
            {
              "id": "7",
              "name": "minBatchThreshold",
              "value": "={{ $('å­—å¹•é…ç½®').first().json.minBatchThreshold }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "258ed630-e759-497d-9815-d9c4ba7ce805",
      "name": "è®¾ç½®å·¥ä½œå˜é‡",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3520,
        224
      ]
    },
    {
      "parameters": {
        "executeOnce": false,
        "command": "=ffmpeg -y -i \"{{ $json.workDir }}/{{ $json.fileName }}\" -vn -acodec pcm_s16le -ar 16000 -ac 1 \"{{ $json.workDir }}/{{ $json.audioFile }}\""
      },
      "id": "f96d2237-f906-4019-8f6c-1e8964e76462",
      "name": "æå–éŸ³é¢‘",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -3328,
        224
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "workDir",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.workDir }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "baseName",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.baseName }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "fileName",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.fileName }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "srtPath",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.workDir }}/{{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.baseName }}_audio.srt",
              "type": "string"
            },
            {
              "id": "5",
              "name": "subtitleMode",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.subtitleMode }}",
              "type": "string"
            },
            {
              "id": "6",
              "name": "batchSize",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.batchSize }}",
              "type": "number"
            },
            {
              "id": "7",
              "name": "minBatchThreshold",
              "value": "={{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.minBatchThreshold }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "1f342ae0-b10f-4cea-8554-b5f3e1054fbc",
      "name": "æ¢å¤å˜é‡",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2880,
        224
      ]
    },
    {
      "parameters": {
        "fileSelector": "={{ $('å­—å¹•é…ç½®').first().json.workDir }}/*.mp4",
        "options": {}
      },
      "id": "a5544dea-0acc-426a-ae3c-a5dad639fa01",
      "name": "è¯»å–è‹±æ–‡è§†é¢‘",
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -4032,
        224
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -4480,
        224
      ],
      "id": "9c2f708b-c142-471b-aaf5-bb27a8966d24",
      "name": "When clicking 'Execute workflow'"
    },
    {
      "parameters": {
        "executeOnce": false,
        "command": "=\"D:/openai-whisper/env/python.exe\" \"D:/openai-whisper/env/Scripts/whisper.exe\" \"{{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.workDir }}/{{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.audioFile }}\" --model large --language English --task transcribe --output_format srt --output_dir \"{{ $('è®¾ç½®å·¥ä½œå˜é‡').item.json.workDir }}\" --word_timestamps True --condition_on_previous_text True --no_speech_threshold 0.6"
      },
      "id": "b60c7210-07bc-4868-9c86-10e87420082c",
      "name": "Whisperè¯†åˆ«è‹±æ–‡å­—å¹•",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -3088,
        192
      ]
    },
    {
      "parameters": {
        "jsCode": "// âœ… ä¿®å¤ç‰ˆ:æ‰¹é‡åˆå¹¶å­—å¹•\n\ntry {\n  const items = $input.all();\n  const batchSize = items[0].json.batchSize;\n\n  console.log(`\\nğŸ“¦ å¼€å§‹æ‰¹é‡åˆå¹¶: æ€»å…± ${items.length} æ¡å­—å¹•`);\n  console.log(`âš™ï¸ æ‰¹æ¬¡å¤§å°: ${batchSize} æ¡/æ‰¹\\n`);\n\n  const batches = [];\n\n  for (let i = 0; i < items.length; i += batchSize) {\n    const batch = items.slice(i, i + batchSize);\n    \n    // âœ… ä¿®å¤:ç›´æ¥ä½¿ç”¨åŸå§‹æ–‡æœ¬,ç”¨çœŸæ­£çš„æ¢è¡Œç¬¦è¿æ¥\n    // âŒ æ—§ä»£ç : .join('\\\\\\\\n\\\\\\\\n') - äº§ç”Ÿå­—é¢å­—ç¬¦ä¸²\n    // âœ… æ–°ä»£ç : .join('\\n\\n') - äº§ç”ŸçœŸæ­£çš„æ¢è¡Œç¬¦\n    const combinedText = batch.map((item) => {\n      return `[${item.json.index}] ${item.json.englishText}`;\n    }).join('\\n\\n');\n    \n    const batchInfo = {\n      json: {\n        batchId: Math.floor(i / batchSize) + 1,\n        batchStart: i + 1,\n        batchEnd: Math.min(i + batchSize, items.length),\n        batchSize: batch.length,\n        combinedText: combinedText,\n        originalItems: batch.map(item => ({\n          index: item.json.index,\n          time: item.json.time,\n          startTime: item.json.startTime,\n          endTime: item.json.endTime,\n          startSeconds: item.json.startSeconds,\n          endSeconds: item.json.endSeconds,\n          duration: item.json.duration,\n          englishText: item.json.englishText,\n          workDir: item.json.workDir,\n          baseName: item.json.baseName,\n          fileName: item.json.fileName,\n          subtitleMode: item.json.subtitleMode\n        })),\n        workDir: batch[0].json.workDir,\n        baseName: batch[0].json.baseName,\n        fileName: batch[0].json.fileName,\n        subtitleMode: batch[0].json.subtitleMode\n      }\n    };\n    \n    batches.push(batchInfo);\n    console.log(`âœ… æ‰¹æ¬¡ ${batchInfo.json.batchId}: å­—å¹• ${batchInfo.json.batchStart}-${batchInfo.json.batchEnd} (${batch.length}æ¡)`);\n  }\n\n  console.log(`\\nğŸ‰ æ‰¹é‡åˆå¹¶å®Œæˆ: ${items.length} æ¡ â†’ ${batches.length} æ‰¹\\n`);\n\n  return batches;\n\n} catch (error) {\n  console.error('âŒ æ‰¹é‡åˆå¹¶å¤±è´¥:', error.message);\n  throw error;\n}"
      },
      "id": "2862cfc3-9d6d-4ace-8e90-79b9f6a4de25",
      "name": "æ‰¹é‡åˆå¹¶å­—å¹•",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2000,
        16
      ],
      "notes": "âœ… å·²ä¿®å¤æ¢è¡Œç¬¦é—®é¢˜,åˆ é™¤escapeJsonString"
    },
    {
      "parameters": {
        "jsCode": "// âœ… ä¿®å¤ç‰ˆ:èšåˆæ‰€æœ‰ç»“æœ(å«è¯¦ç»†è°ƒè¯•ä¿¡æ¯)\n\ntry {\n  const preparedItems = $('å‡†å¤‡TTSå‘½ä»¤').all();\n\n  if (!preparedItems || preparedItems.length === 0) {\n    throw new Error('æ²¡æœ‰ä»\"å‡†å¤‡TTSå‘½ä»¤\"èŠ‚ç‚¹è·å–åˆ°æ•°æ®!');\n  }\n\n  console.log('\\n' + '='.repeat(70));\n  console.log('ğŸ“¦ èšåˆæ‰€æœ‰ç»“æœ - å¼€å§‹å¤„ç†');\n  console.log('='.repeat(70));\n  console.log(`ğŸ“Š æ¥æ”¶é¡¹ç›®æ•°: ${preparedItems.length} æ¡`);\n  \n  // âœ… å…³é”®è°ƒè¯•:æ£€æŸ¥ç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ•°æ®ç»“æ„\n  const firstItem = preparedItems[0].json;\n  console.log('\\nğŸ” ç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ•°æ®ç»“æ„æ£€æŸ¥:');\n  console.log(`  - index: ${firstItem.index}`);\n  console.log(`  - englishText: ${firstItem.englishText ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}`);\n  console.log(`  - chineseText: ${firstItem.chineseText ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}`);\n  console.log(`  - time: ${firstItem.time}`);\n  console.log(`  - duration: ${firstItem.duration}s`);\n  \n  // âœ… å¦‚æœchineseTextç¼ºå¤±,æ˜¾ç¤ºå®Œæ•´çš„keys\n  if (!firstItem.chineseText) {\n    console.error('\\nâš ï¸ è­¦å‘Š: chineseTextå­—æ®µç¼ºå¤±!');\n    console.error('å¯ç”¨å­—æ®µ:', Object.keys(firstItem));\n  }\n  \n  const workDir = firstItem.workDir;\n  const baseName = firstItem.baseName;\n  const fileName = firstItem.fileName;\n  const subtitleMode = firstItem.subtitleMode || 'both';\n  \n  // è·å–å¯é…ç½®çš„éŸ³é‡å‚æ•°\n  const volumeLevel = $('å­—å¹•é…ç½®').first().json.volumeLevel || 1.8;\n\n  console.log(`\\nâš™ï¸ é…ç½®ä¿¡æ¯:`);\n  console.log(`  - å·¥ä½œç›®å½•: ${workDir}`);\n  console.log(`  - åŸºç¡€åç§°: ${baseName}`);\n  console.log(`  - å­—å¹•æ¨¡å¼: ${subtitleMode}`);\n  console.log(`  - éŸ³é‡è®¾ç½®: ${volumeLevel}x`);\n\n  const sortedItems = preparedItems.sort((a, b) => a.json.index - b.json.index);\n  const outputAudio = `${workDir}/${baseName}_chinese_audio.mp3`;\n\n  console.log('\\n' + '='.repeat(70));\n  console.log('ğŸµ éŸ³é¢‘æ—¶é—´è½´å¯¹é½å¤„ç†');\n  console.log('='.repeat(70));\n\n  const lastItem = sortedItems[sortedItems.length - 1].json;\n  const estimatedDuration = (lastItem.endSeconds || lastItem.startSeconds || 60) + 2;\n\n  console.log(`ğŸ“Š è§†é¢‘é¢„ä¼°æ—¶é•¿: ${estimatedDuration.toFixed(2)}ç§’`);\n  console.log(`ğŸ“ å¤„ç†å­—å¹•æ•°: ${sortedItems.length} æ¡\\n`);\n\n  const filterInputs = [];\n  const filterComplex = [];\n  const mixInputs = [];\n\n  sortedItems.forEach((item, idx) => {\n    const sub = item.json;\n    const startSec = sub.startSeconds || 0;\n    const delayMs = Math.round(startSec * 1000);\n    \n    filterInputs.push(`-i \"${sub.audioOutputFile}\"`);\n    // âœ… åˆ é™¤ loudnorm æ»¤é•œï¼Œä»…ä¿ç•™ adelayï¼ˆæ§åˆ¶ç‰‡æ®µæ—¶é—´å¯¹é½ï¼‰\n    filterComplex.push(`[${idx + 1}:a]adelay=${delayMs}|${delayMs}[a${idx}]`);\n    mixInputs.push(`[a${idx}]`);\n  });\n  \n  // âœ… ç»™ amix åŠ  normalize=0ï¼Œå…³é—­é»˜è®¤éŸ³é‡å‡åˆ†ï¼ˆå…³é”®ï¼ï¼‰\n  const inputCount = sortedItems.length;\n  const mixFilter = `${mixInputs.join('')}amix=inputs=${inputCount}:duration=longest:normalize=0[aout]`;\n  filterComplex.push(mixFilter);\n\n  const fullFilterComplex = filterComplex.join(';');\n\n  const ffmpegCommand = `cd /d \"${workDir}\" && ffmpeg -y -f lavfi -t ${estimatedDuration} -i anullsrc=r=44100:cl=stereo ${filterInputs.join(' ')} -filter_complex \"${fullFilterComplex}\" -map \"[aout]\" -c:a libmp3lame -b:a 192k -t ${estimatedDuration} \"${outputAudio}\"`;\n\n  console.log('âœ… FFmpegå‘½ä»¤å·²ç”Ÿæˆ\\n');\n\n  // ========== å…³é”®éƒ¨åˆ†:ç”Ÿæˆå­—å¹•å†…å®¹ ==========\n  console.log('='.repeat(70));\n  console.log('ğŸ“ ç”Ÿæˆå­—å¹•æ–‡ä»¶');\n  console.log('='.repeat(70));\n\n  let bilingualSrt = '';\n  let srtSuffix = '';\n\n  switch(subtitleMode) {\n    case 'none':\n      bilingualSrt = '';\n      srtSuffix = 'none';\n      console.log('ğŸš« å­—å¹•æ¨¡å¼: æ— å­—å¹•');\n      break;\n      \n    case 'english':\n      bilingualSrt = sortedItems.map(item => {\n        const sub = item.json;\n        return `${sub.index}\\n${sub.time}\\n${sub.englishText}\\n`;\n      }).join('\\n');\n      srtSuffix = 'english';\n      console.log('ğŸ‡¬ğŸ‡§ å­—å¹•æ¨¡å¼: ä»…è‹±æ–‡');\n      console.log(`ğŸ“Š ç”Ÿæˆå†…å®¹é•¿åº¦: ${bilingualSrt.length} å­—ç¬¦`);\n      break;\n      \n    case 'chinese':\n      // âœ… æ·»åŠ æ£€æŸ¥:ç¡®ä¿chineseTextå­˜åœ¨\n      const missingChinese = sortedItems.filter(item => !item.json.chineseText);\n      if (missingChinese.length > 0) {\n        console.error(`\\nâŒ é”™è¯¯: ${missingChinese.length} æ¡å­—å¹•ç¼ºå°‘ä¸­æ–‡ç¿»è¯‘!`);\n        console.error('ç¼ºå¤±çš„ç´¢å¼•:', missingChinese.map(i => i.json.index).slice(0, 10).join(', '));\n        throw new Error('éƒ¨åˆ†å­—å¹•ç¼ºå°‘ä¸­æ–‡ç¿»è¯‘,æ— æ³•ç”Ÿæˆä¸­æ–‡å­—å¹•');\n      }\n      \n      bilingualSrt = sortedItems.map(item => {\n        const sub = item.json;\n        return `${sub.index}\\n${sub.time}\\n${sub.chineseText}\\n`;\n      }).join('\\n');\n      srtSuffix = 'chinese';\n      console.log('ğŸ‡¨ğŸ‡³ å­—å¹•æ¨¡å¼: ä»…ä¸­æ–‡');\n      console.log(`ğŸ“Š ç”Ÿæˆå†…å®¹é•¿åº¦: ${bilingualSrt.length} å­—ç¬¦`);\n      break;\n      \n    case 'both':\n    default:\n      // âœ… æ·»åŠ æ£€æŸ¥:ç¡®ä¿ä¸¤ç§è¯­è¨€éƒ½å­˜åœ¨\n      const missingBoth = sortedItems.filter(item => \n        !item.json.englishText || !item.json.chineseText\n      );\n      if (missingBoth.length > 0) {\n        console.error(`\\nâŒ é”™è¯¯: ${missingBoth.length} æ¡å­—å¹•æ•°æ®ä¸å®Œæ•´!`);\n        console.error('ç¼ºå¤±çš„ç´¢å¼•:', missingBoth.map(i => i.json.index).slice(0, 10).join(', '));\n        throw new Error('éƒ¨åˆ†å­—å¹•æ•°æ®ä¸å®Œæ•´,æ— æ³•ç”ŸæˆåŒè¯­å­—å¹•');\n      }\n      \n      bilingualSrt = sortedItems.map(item => {\n        const sub = item.json;\n        return `${sub.index}\\n${sub.time}\\n${sub.englishText}\\n${sub.chineseText}\\n`;\n      }).join('\\n');\n      srtSuffix = 'bilingual';\n      console.log('ğŸŒ å­—å¹•æ¨¡å¼: åŒè¯­å­—å¹•');\n      console.log(`ğŸ“Š ç”Ÿæˆå†…å®¹é•¿åº¦: ${bilingualSrt.length} å­—ç¬¦`);\n      break;\n  }\n\n  // âœ… æ˜¾ç¤ºå­—å¹•å†…å®¹é¢„è§ˆ\n  if (bilingualSrt && bilingualSrt.length > 0) {\n    const lines = bilingualSrt.split('\\n');\n    const preview = lines.slice(0, 12).join('\\n');\n    console.log('\\nğŸ“„ å­—å¹•å†…å®¹é¢„è§ˆ(å‰12è¡Œ):');\n    console.log(preview);\n    if (lines.length > 12) {\n      console.log('...');\n      console.log(`(å…± ${lines.length} è¡Œ)`);\n    }\n  } else if (subtitleMode !== 'none') {\n    console.error('\\nâš ï¸ è­¦å‘Š: å­—å¹•å†…å®¹ä¸ºç©º!');\n  }\n\n  const srtFilePath = `${workDir}/${baseName}_${srtSuffix}.srt`;\n  const srtFileName = `${baseName}_${srtSuffix}.srt`;\n\n  console.log(`\\nğŸ“ å­—å¹•æ–‡ä»¶è·¯å¾„: ${srtFilePath}`);\n  console.log(`ğŸ“ å­—å¹•æ–‡ä»¶å: ${srtFileName}`);\n  console.log('='.repeat(70));\n\n  console.log('\\nâœ… èšåˆå¤„ç†å®Œæˆ!');\n  console.log(`   - æ€»è®¡å¤„ç†: ${sortedItems.length} æ¡å­—å¹•`);\n  console.log(`   - å­—å¹•å†…å®¹: ${bilingualSrt.length} å­—ç¬¦`);\n  console.log(`   - éŸ³é¢‘æ–‡ä»¶: ${outputAudio}`);\n  console.log('='.repeat(70) + '\\n');\n\n  return [{\n    json: {\n      workDir: workDir,\n      baseName: baseName,\n      fileName: fileName,\n      outputAudio: outputAudio,\n      bilingualSrt: bilingualSrt,\n      srtFilePath: srtFilePath,\n      srtFileName: srtFileName,\n      subtitleMode: subtitleMode,\n      totalItems: sortedItems.length,\n      ffmpegCommand: ffmpegCommand,\n      estimatedDuration: estimatedDuration,\n      volumeLevel: volumeLevel\n    }\n  }];\n\n} catch (error) {\n  console.error('\\n' + '='.repeat(70));\n  console.error('âŒ èšåˆå¤„ç†å¤±è´¥');\n  console.error('='.repeat(70));\n  console.error('é”™è¯¯ä¿¡æ¯:', error.message);\n  console.error('é”™è¯¯å †æ ˆ:', error.stack);\n  console.error('='.repeat(70) + '\\n');\n  throw error;\n}"
      },
      "id": "c5b9886c-5ab5-41b0-84d9-a00940b349c8",
      "name": "èšåˆæ‰€æœ‰ç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        144
      ],
      "notes": "âœ… å·²ä¿®å¤éŸ³é‡è®¾ç½®,ä½¿ç”¨loudnormæ ‡å‡†åŒ–"
    },
    {
      "parameters": {
        "executeOnce": false,
        "command": "={{ $json.ffmpegCommand }}"
      },
      "id": "56dc9141-63bd-4a6b-9392-dcb928343b38",
      "name": "åˆå¹¶éŸ³é¢‘ç‰‡æ®µ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        -448,
        96
      ],
      "notes": "âœ… ä½¿ç”¨ä¼˜åŒ–åçš„æ—¶é—´è½´å¯¹é½ç­–ç•¥"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ¬ å‡†å¤‡è§†é¢‘åˆæˆå‘½ä»¤(å®Œå…¨ä¿®å¤ç‰ˆ)\n\nconst data = $('æ¢å¤å˜é‡2').first().json;\nconst workDir = data.workDir;\nconst baseName = data.baseName;\nconst fileName = data.fileName || `${baseName}.mp4`;\nconst outputDir = $('å­—å¹•é…ç½®').first().json.outputDir;\nconst subtitleMode = data.subtitleMode;\n\nconsole.log('\\n' + '='.repeat(70));\nconsole.log('ğŸ¬ å‡†å¤‡è§†é¢‘åˆæˆå‘½ä»¤');\nconsole.log('='.repeat(70));\nconsole.log(`ğŸ“‚ å·¥ä½œç›®å½•: ${workDir}`);\nconsole.log(`ğŸ“¹ è¾“å…¥è§†é¢‘: ${fileName}`);\nconsole.log(`ğŸµ ä¸­æ–‡éŸ³é¢‘: ${baseName}_chinese_audio.mp3`);\nconsole.log(`ğŸ­ å­—å¹•æ¨¡å¼: ${subtitleMode}`);\nconsole.log(`ğŸ“¤ è¾“å‡ºç›®å½•: ${outputDir}`);\n\nlet ffmpegCommand;\n\nif (subtitleMode === 'none') {\n  // ========== æ— å­—å¹•æ¨¡å¼ ==========\n  console.log('\\nâœ… æ¨¡å¼: ä»…æ›¿æ¢éŸ³é¢‘(ä¸çƒ§å½•å­—å¹•)');\n  \n  ffmpegCommand = [\n    `cd /d \"${workDir}\"`,\n    '&&',\n    'ffmpeg -y',\n    `-i \"${fileName}\"`,\n    `-i \"${baseName}_chinese_audio.mp3\"`,\n    '-map 0:v -map 1:a',\n    '-c:v copy',\n    '-c:a aac -b:a 192k',\n    `\"${outputDir}/${baseName}_chinese.mp4\"`\n  ].join(' ');\n  \n  console.log('ğŸš€ ç¼–ç æ–¹å¼: è§†é¢‘ç›´æ¥å¤åˆ¶(æœ€å¿«)');\n  \n} else {\n  // ========== æœ‰å­—å¹•æ¨¡å¼ ==========\n  const srtFileName = data.srtFileName;\n  \n  // âœ… å…³é”®ä¿®å¤:ä½¿ç”¨ç›¸å¯¹è·¯å¾„,å› ä¸ºå·²ç»cdåˆ°å·¥ä½œç›®å½•\n  // è¿™æ ·å¯ä»¥é¿å…Windowsè·¯å¾„ä¸­å†’å·çš„è½¬ä¹‰é—®é¢˜\n  console.log(`\\nğŸ“„ å­—å¹•æ–‡ä»¶: ${srtFileName}`);\n  console.log(`ğŸ“ ä½¿ç”¨ç›¸å¯¹è·¯å¾„é¿å…Windowsè·¯å¾„é—®é¢˜`);\n  console.log(`âœ… æ¨¡å¼: çƒ§å½•${subtitleMode}å­—å¹•åˆ°è§†é¢‘`);\n  \n  // æ–¹æ¡ˆ1: ä½¿ç”¨ç›¸å¯¹è·¯å¾„(æ¨è,ç®€å•å¯é )\n  const subtitleFilter = `subtitles=${srtFileName}:force_style='FontName=Microsoft YaHei,FontSize=14,PrimaryColour=&H00FFFFFF,OutlineColour=&H00000000,Outline=1,MarginV=20'`;\n  \n  // æ–¹æ¡ˆ2å¤‡æ³¨: å¦‚æœéœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„,å¿…é¡»è½¬ä¹‰å†’å·\n  // const srtFullPath = `${workDir}/${srtFileName}`.replace(/\\\\/g, '/').replace(/:/g, '\\\\\\\\:');\n  // const subtitleFilter = `subtitles='${srtFullPath}':force_style='...'`;\n  \n  console.log(`\\nğŸ”§ å­—å¹•æ»¤é•œ: ${subtitleFilter}`);\n  \n  ffmpegCommand = [\n    `cd /d \"${workDir}\"`,\n    '&&',\n    'ffmpeg -y',\n    `-i \"${fileName}\"`,\n    `-i \"${baseName}_chinese_audio.mp3\"`,\n    `-vf \"${subtitleFilter}\"`,\n    '-map 0:v -map 1:a',\n    '-c:v libx264 -preset medium -crf 23',\n    '-c:a aac -b:a 192k',\n    `\"${outputDir}/${baseName}_chinese.mp4\"`\n  ].join(' ');\n  \n  console.log('ğŸš€ ç¼–ç æ–¹å¼: é‡æ–°ç¼–ç (çƒ§å½•å­—å¹•)');\n}\n\nconsole.log(`\\nğŸ“‹ å‘½ä»¤é•¿åº¦: ${ffmpegCommand.length} å­—ç¬¦`);\nconsole.log('\\nğŸ” å®Œæ•´å‘½ä»¤:');\nconsole.log(ffmpegCommand);\nconsole.log('='.repeat(70) + '\\n');\n\nreturn [{\n  json: {\n    ...data,\n    ffmpegCommand: ffmpegCommand,\n    videoOutputPath: `${outputDir}/${baseName}_chinese.mp4`\n  }\n}];"
      },
      "id": "6ee4d062-6fe9-4052-a24e-e90ec5c3074d",
      "name": "å‡†å¤‡è§†é¢‘åˆæˆå‘½ä»¤",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        48
      ],
      "notes": "MarginV å­—å¹•ä½ç½®å¤§å°,é»˜è®¤20  æ•°å€¼è¶Šå¤§ï¼Œå­—å¹•ä½ç½®è¶Šé ä¸Šï¼ˆè¿œç¦»åº•éƒ¨è¾¹ç¼˜ï¼‰ï¼›æ•°å€¼è¶Šå°ï¼Œå­—å¹•è¶Šé è¿‘åº•éƒ¨è¾¹ç¼˜ã€‚\nå­—ä½“é¢œè‰²ï¼šç”± PrimaryColour æ§åˆ¶\næè¾¹é¢œè‰²ï¼šç”± OutlineColour æ§åˆ¶\næè¾¹ç²—ç»†ï¼šç”± Outline æ§åˆ¶,æ•°å€¼è¶Šå¤§æè¾¹è¶Šç²—"
    },
    {
      "parameters": {
        "executeOnce": false,
        "command": "={{ $json.ffmpegCommand }}"
      },
      "id": "d4940b48-71d0-4df2-a838-3e3bef70a428",
      "name": "æ‰§è¡Œè§†é¢‘åˆæˆ",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        1424,
        80
      ],
      "notes": "æ‰§è¡ŒFFmpegå‘½ä»¤"
    },
    {
      "parameters": {
        "jsCode": "// âœ… ä¿®å¤ç‰ˆ:éªŒè¯å­—å¹•æ–‡ä»¶\n// å…³é”®ä¿®å¤:æ˜¾å¼ä»\"èšåˆæ‰€æœ‰ç»“æœ\"èŠ‚ç‚¹è·å–æ•°æ®,ç¡®ä¿æœ‰ bilingualSrt å­—æ®µ\n\nconst aggregatedData = $('èšåˆæ‰€æœ‰ç»“æœ').first().json;\nconst subtitleMode = aggregatedData.subtitleMode;\n\nif (subtitleMode === 'none') {\n  console.log('â„¹ï¸  æ— å­—å¹•æ¨¡å¼,è·³è¿‡å­—å¹•éªŒè¯\\n');\n  return [{ json: $input.first().json }];\n}\n\nconst srtFilePath = aggregatedData.srtFilePath;\nconst srtFileName = aggregatedData.srtFileName;\nconst srtContent = aggregatedData.bilingualSrt || '';\n\nconsole.log('\\n' + '='.repeat(60));\nconsole.log('ğŸ” å­—å¹•æ–‡ä»¶éªŒè¯');\nconsole.log('='.repeat(60));\nconsole.log(`ğŸ“ æ–‡ä»¶è·¯å¾„: ${srtFilePath}`);\nconsole.log(`ğŸ“ æ–‡ä»¶å: ${srtFileName}`);\nconsole.log(`ğŸ“Š å†…å®¹é•¿åº¦: ${srtContent.length} å­—ç¬¦`);\nconsole.log(`ğŸ“„ è¡Œæ•°: ${srtContent.split('\\n').length} è¡Œ`);\n\n// éªŒè¯å†…å®¹\nif (!srtContent || srtContent.length === 0) {\n  console.error('\\nâŒ é”™è¯¯: å­—å¹•å†…å®¹ä¸ºç©º!');\n  console.error('è°ƒè¯•ä¿¡æ¯:');\n  console.error('  - subtitleMode:', subtitleMode);\n  console.error('  - srtFilePath:', srtFilePath);\n  console.error('  - srtFileName:', srtFileName);\n  console.error('\\nğŸ’¡ å¯èƒ½çš„åŸå› :');\n  console.error('  1. \"èšåˆæ‰€æœ‰ç»“æœ\"èŠ‚ç‚¹æœªæ­£ç¡®ç”Ÿæˆå­—å¹•');\n  console.error('  2. bilingualSrt å­—æ®µä¸ºç©ºæˆ–æœªå®šä¹‰');\n  console.error('  3. è¯·æ£€æŸ¥\"èšåˆæ‰€æœ‰ç»“æœ\"èŠ‚ç‚¹çš„æ—¥å¿—è¾“å‡º');\n  throw new Error('å­—å¹•å†…å®¹ä¸ºç©º,æ— æ³•ç»§ç»­å¤„ç†');\n}\n\nif (!srtFilePath || srtFilePath.includes('undefined')) {\n  console.error('âŒ é”™è¯¯: å­—å¹•æ–‡ä»¶è·¯å¾„æ— æ•ˆ!');\n  throw new Error(`å­—å¹•æ–‡ä»¶è·¯å¾„æ— æ•ˆ: ${srtFilePath}`);\n}\n\n// æ˜¾ç¤ºå‰å‡ è¡Œå†…å®¹é¢„è§ˆ\nconst preview = srtContent.split('\\n').slice(0, 8).join('\\n');\nconsole.log('\\nğŸ“‹ å†…å®¹é¢„è§ˆ:');\nconsole.log(preview);\nconsole.log('...');\n\nconsole.log('\\nâœ… å­—å¹•æ–‡ä»¶éªŒè¯é€šè¿‡!');\nconsole.log('='.repeat(60) + '\\n');\n\n// è¿”å›ä¸Šæ¸¸çš„æ•°æ®(æ¢å¤å˜é‡2çš„è¾“å‡º)\nreturn [{ json: $input.first().json }];"
      },
      "id": "68d238b9-ab1c-40cb-a02b-fe54498949de",
      "name": "éªŒè¯å­—å¹•æ–‡ä»¶",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        16
      ],
      "notes": "âœ… å·²ä¿®å¤: æ˜¾å¼ä»\"èšåˆæ‰€æœ‰ç»“æœ\"è·å– bilingualSrt"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -3792,
        192
      ],
      "id": "add1056e-6424-4af4-915a-908145b5527f",
      "name": "Loop Over Items"
    }
  ],
  "pinData": {},
  "repo_name": "n8nbak",
  "repo_owner": "wodaili-kingpwf",
  "repo_path": "",
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-10-22T13:07:39.030Z",
      "createdAt": "2025-10-22T13:07:39.030Z",
      "role": "workflow:owner",
      "workflowId": "wKeZ7O43kUAu5AIB",
      "projectId": "bhYbeEidmtHtdTx7"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-10-22T13:07:39.026Z",
  "versionId": "6d1e6323-4e05-4408-9f2e-44c6a797dfb3"
}